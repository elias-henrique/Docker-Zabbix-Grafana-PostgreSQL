define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","app/core/config","app/core/core","app/core/table_model","app/core/utils/datemath","app/core/utils/kbn","lodash","moment","react","react-dom"],((e,t,n,r,i,o,a,s,l,u,c,d,p)=>(()=>{var m={5295:(e,t,n)=>{"use strict";const r=n(7372),i=Symbol("max"),o=Symbol("length"),a=Symbol("lengthCalculator"),s=Symbol("allowStale"),l=Symbol("maxAge"),u=Symbol("dispose"),c=Symbol("noDisposeOnSet"),d=Symbol("lruList"),p=Symbol("cache"),m=Symbol("updateAgeOnGet"),h=()=>1,g=(e,t,n)=>{const r=e[p].get(t);if(r){const t=r.value;if(f(e,t)){if(b(e,r),!e[s])return}else n&&(e[m]&&(r.value.now=Date.now()),e[d].unshiftNode(r));return t.value}},f=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[l]&&n>e[l]},v=e=>{if(e[o]>e[i])for(let t=e[d].tail;e[o]>e[i]&&null!==t;){const n=t.prev;b(e,t),t=n}},b=(e,t)=>{if(t){const n=t.value;e[u]&&e[u](n.key,n.value),e[o]-=n.length,e[p].delete(n.key),e[d].removeNode(t)}};class y{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const E=(e,t,n,r)=>{let i=n.value;f(e,i)&&(b(e,n),e[s]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||h;if(this[a]="function"!=typeof t?h:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[m]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,v(this)}get max(){return this[i]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,v(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=h),e!==this[a]&&(this[a]=e,this[o]=0,this[d].forEach((e=>{e.length=this[a](e.value,e.key),this[o]+=e.length}))),v(this)}get lengthCalculator(){return this[a]}get length(){return this[o]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let n=this[d].tail;null!==n;){const r=n.prev;E(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[d].head;null!==n;){const r=n.next;E(this,e,n,t),n=r}}keys(){return this[d].toArray().map((e=>e.key))}values(){return this[d].toArray().map((e=>e.value))}reset(){this[u]&&this[d]&&this[d].length&&this[d].forEach((e=>this[u](e.key,e.value))),this[p]=new Map,this[d]=new r,this[o]=0}dump(){return this[d].map((e=>!f(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[d]}set(e,t,n){if((n=n||this[l])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,s=this[a](t,e);if(this[p].has(e)){if(s>this[i])return b(this,this[p].get(e)),!1;const a=this[p].get(e).value;return this[u]&&(this[c]||this[u](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[o]+=s-a.length,a.length=s,this.get(e),v(this),!0}const m=new y(e,t,s,r,n);return m.length>this[i]?(this[u]&&this[u](e,t),!1):(this[o]+=m.length,this[d].unshift(m),this[p].set(e,this[d].head),v(this),!0)}has(e){if(!this[p].has(e))return!1;const t=this[p].get(e).value;return!f(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[d].tail;return e?(b(this,e),e.value):null}del(e){b(this,this[p].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[p].forEach(((e,t)=>g(this,t,!1)))}}},3134:(e,t,n)=>{const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=o(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){const t=this.options.loose?a[s.COMPARATORLOOSE]:a[s.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=o(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=i;const o=n(8716),{safeRe:a,t:s}=n(9022),l=n(5452),u=n(6830),c=n(9510),d=n(7374)},7374:(e,t,n)=>{class r{constructor(e,t){if(t=o(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof a)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!f(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&h)|(this.options.loose&&g))+":"+e,n=i.get(t);if(n)return n;const r=this.options.loose,o=r?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];e=e.replace(o,D(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(u[c.COMPARATORTRIM],d),s("comparator trim",e),e=e.replace(u[c.TILDETRIM],p),s("tilde trim",e),e=e.replace(u[c.CARETTRIM],m),s("caret trim",e);let l=e.split(" ").map((e=>y(e,this.options))).join(" ").split(/\s+/).map((e=>A(e,this.options)));r&&(l=l.filter((e=>(s("loose invalid filter",e,this.options),!!e.match(u[c.COMPARATORLOOSE]))))),s("range list",l);const v=new Map,b=l.map((e=>new a(e,this.options)));for(const e of b){if(f(e))return[e];v.set(e.value,e)}v.size>1&&v.has("")&&v.delete("");const E=[...v.values()];return i.set(t,E),E}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>b(n,t)&&e.set.some((e=>b(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(C(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const i=new(n(5295))({max:1e3}),o=n(8716),a=n(3134),s=n(6830),l=n(9510),{safeRe:u,t:c,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:m}=n(9022),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:g}=n(39),f=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,b=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},y=(e,t)=>(s("comp",e,t),e=T(e,t),s("caret",e),e=I(e,t),s("tildes",e),e=x(e,t),s("xrange",e),e=S(e,t),s("stars",e),e),E=e=>!e||"x"===e.toLowerCase()||"*"===e,I=(e,t)=>e.trim().split(/\s+/).map((e=>w(e,t))).join(" "),w=(e,t)=>{const n=t.loose?u[c.TILDELOOSE]:u[c.TILDE];return e.replace(n,((t,n,r,i,o)=>{let a;return s("tilde",e,t,n,r,i,o),E(n)?a="":E(r)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:E(i)?a=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:o?(s("replaceTilde pr",o),a=`>=${n}.${r}.${i}-${o} <${n}.${+r+1}.0-0`):a=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",a),a}))},T=(e,t)=>e.trim().split(/\s+/).map((e=>O(e,t))).join(" "),O=(e,t)=>{s("caret",e,t);const n=t.loose?u[c.CARETLOOSE]:u[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,o,a)=>{let l;return s("caret",e,t,n,i,o,a),E(n)?l="":E(i)?l=`>=${n}.0.0${r} <${+n+1}.0.0-0`:E(o)?l="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:a?(s("replaceCaret pr",a),l="0"===n?"0"===i?`>=${n}.${i}.${o}-${a} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}-${a} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o}-${a} <${+n+1}.0.0-0`):(s("no pr"),l="0"===n?"0"===i?`>=${n}.${i}.${o}${r} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o} <${+n+1}.0.0-0`),s("caret return",l),l}))},x=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map((e=>P(e,t))).join(" ")),P=(e,t)=>{e=e.trim();const n=t.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return e.replace(n,((n,r,i,o,a,l)=>{s("xRange",e,n,r,i,o,a,l);const u=E(i),c=u||E(o),d=c||E(a),p=d;return"="===r&&p&&(r=""),l=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&p?(c&&(o=0),a=0,">"===r?(r=">=",c?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):"<="===r&&(r="<",c?i=+i+1:o=+o+1),"<"===r&&(l="-0"),n=`${r+i}.${o}.${a}${l}`):c?n=`>=${i}.0.0${l} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${o}.0${l} <${i}.${+o+1}.0-0`),s("xRange return",n),n}))},S=(e,t)=>(s("replaceStars",e,t),e.trim().replace(u[c.STAR],"")),A=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),D=e=>(t,n,r,i,o,a,s,l,u,c,d,p,m)=>`${n=E(r)?"":E(i)?`>=${r}.0.0${e?"-0":""}`:E(o)?`>=${r}.${i}.0${e?"-0":""}`:a?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=E(u)?"":E(c)?`<${+u+1}.0.0-0`:E(d)?`<${u}.${+c+1}.0-0`:p?`<=${u}.${c}.${d}-${p}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`}`.trim(),C=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(s(e[n].semver),e[n].semver!==a.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},9510:(e,t,n)=>{const r=n(6830),{MAX_LENGTH:i,MAX_SAFE_INTEGER:o}=n(39),{safeRe:a,t:s}=n(9022),l=n(8716),{compareIdentifiers:u}=n(8822);class c{constructor(e,t){if(t=l(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?a[s.LOOSE]:a[s.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return u(n,i)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},6457:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},5452:(e,t,n)=>{const r=n(8565),i=n(3328),o=n(2260),a=n(6579),s=n(290),l=n(5891);e.exports=(e,t,n,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,u);case"!=":return i(e,n,u);case">":return o(e,n,u);case">=":return a(e,n,u);case"<":return s(e,n,u);case"<=":return l(e,n,u);default:throw new TypeError(`Invalid operator: ${t}`)}}},9469:(e,t,n)=>{const r=n(9510),i=n(5692),{safeRe:o,t:a}=n(9022);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=o[a.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),o[a.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;o[a.COERCERTL].lastIndex=-1}else n=e.match(o[a.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},1868:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n)=>{const i=new r(e,n),o=new r(t,n);return i.compare(o)||i.compareBuild(o)}},5919:(e,t,n)=>{const r=n(3992);e.exports=(e,t)=>r(e,t,!0)},3992:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},1007:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,null,!0),i=r(t,null,!0),o=n.compare(i);if(0===o)return null;const a=o>0,s=a?n:i,l=a?i:n,u=!!s.prerelease.length;if(l.prerelease.length&&!u)return l.patch||l.minor?s.patch?"patch":s.minor?"minor":"major":"major";const c=u?"pre":"";return n.major!==i.major?c+"major":n.minor!==i.minor?c+"minor":n.patch!==i.patch?c+"patch":"prerelease"}},8565:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>0===r(e,t,n)},2260:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)>0},6579:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)>=0},515:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n,i,o)=>{"string"==typeof n&&(o=i,i=n,n=void 0);try{return new r(e instanceof r?e.version:e,n).inc(t,i,o).version}catch(e){return null}}},290:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)<0},5891:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(e,t,n)<=0},2611:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).major},6319:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).minor},3328:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>0!==r(e,t,n)},5692:(e,t,n)=>{const r=n(9510);e.exports=(e,t,n=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(e){if(!n)return null;throw e}}},7368:(e,t,n)=>{const r=n(9510);e.exports=(e,t)=>new r(e,t).patch},7794:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},9114:(e,t,n)=>{const r=n(3992);e.exports=(e,t,n)=>r(t,e,n)},3843:(e,t,n)=>{const r=n(1868);e.exports=(e,t)=>e.sort(((e,n)=>r(n,e,t)))},9845:(e,t,n)=>{const r=n(7374);e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},8753:(e,t,n)=>{const r=n(1868);e.exports=(e,t)=>e.sort(((e,n)=>r(e,n,t)))},398:(e,t,n)=>{const r=n(5692);e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},8873:(e,t,n)=>{const r=n(9022),i=n(39),o=n(9510),a=n(8822),s=n(5692),l=n(398),u=n(6457),c=n(515),d=n(1007),p=n(2611),m=n(6319),h=n(7368),g=n(7794),f=n(3992),v=n(9114),b=n(5919),y=n(1868),E=n(8753),I=n(3843),w=n(2260),T=n(290),O=n(8565),x=n(3328),P=n(6579),S=n(5891),A=n(5452),D=n(9469),C=n(3134),j=n(7374),R=n(9845),F=n(8384),$=n(6369),N=n(2663),L=n(75),k=n(9178),_=n(9434),M=n(8237),V=n(9860),q=n(8258),B=n(3607),H=n(2199);e.exports={parse:s,valid:l,clean:u,inc:c,diff:d,major:p,minor:m,patch:h,prerelease:g,compare:f,rcompare:v,compareLoose:b,compareBuild:y,sort:E,rsort:I,gt:w,lt:T,eq:O,neq:x,gte:P,lte:S,cmp:A,coerce:D,Comparator:C,Range:j,satisfies:R,toComparators:F,maxSatisfying:$,minSatisfying:N,minVersion:L,validRange:k,outside:_,gtr:M,ltr:V,intersects:q,simplifyRange:B,subset:H,SemVer:o,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:a.compareIdentifiers,rcompareIdentifiers:a.rcompareIdentifiers}},39:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},6830:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},8822:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const r=t.test(e),i=t.test(n);return r&&i&&(e=+e,n=+n),e===n?0:r&&!i?-1:i&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},8716:e=>{const t=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:n},9022:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:o}=n(39),a=n(6830),s=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],c=t.t={};let d=0;const p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",o],[p,i]],h=(e,t,n)=>{const r=(e=>{for(const[t,n]of m)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),i=d++;a(e,i,t),c[e]=i,u[i]=t,s[i]=new RegExp(t,n?"g":void 0),l[i]=new RegExp(r,n?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),h("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${p}+`),h("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),h("FULL",`^${u[c.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),h("LOOSE",`^${u[c.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),h("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),h("COERCERTL",u[c.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},8237:(e,t,n)=>{const r=n(9434);e.exports=(e,t,n)=>r(e,t,">",n)},8258:(e,t,n)=>{const r=n(7374);e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t,n))},9860:(e,t,n)=>{const r=n(9434);e.exports=(e,t,n)=>r(e,t,"<",n)},6369:(e,t,n)=>{const r=n(9510),i=n(7374);e.exports=(e,t,n)=>{let o=null,a=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&-1!==a.compare(e)||(o=e,a=new r(o,n)))})),o}},2663:(e,t,n)=>{const r=n(9510),i=n(7374);e.exports=(e,t,n)=>{let o=null,a=null,s=null;try{s=new i(t,n)}catch(e){return null}return e.forEach((e=>{s.test(e)&&(o&&1!==a.compare(e)||(o=e,a=new r(o,n)))})),o}},75:(e,t,n)=>{const r=n(9510),i=n(7374),o=n(2260);e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let a=null;i.forEach((e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":a&&!o(t,a)||(a=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!a||n&&!o(n,a)||(n=a)}return n&&e.test(n)?n:null}},9434:(e,t,n)=>{const r=n(9510),i=n(3134),{ANY:o}=i,a=n(7374),s=n(9845),l=n(2260),u=n(290),c=n(5891),d=n(6579);e.exports=(e,t,n,p)=>{let m,h,g,f,v;switch(e=new r(e,p),t=new a(t,p),n){case">":m=l,h=c,g=u,f=">",v=">=";break;case"<":m=u,h=d,g=l,f="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,p))return!1;for(let n=0;n<t.set.length;++n){const r=t.set[n];let a=null,s=null;if(r.forEach((e=>{e.semver===o&&(e=new i(">=0.0.0")),a=a||e,s=s||e,m(e.semver,a.semver,p)?a=e:g(e.semver,s.semver,p)&&(s=e)})),a.operator===f||a.operator===v)return!1;if((!s.operator||s.operator===f)&&h(e,s.semver))return!1;if(s.operator===v&&g(e,s.semver))return!1}return!0}},3607:(e,t,n)=>{const r=n(9845),i=n(3992);e.exports=(e,t,n)=>{const o=[];let a=null,s=null;const l=e.sort(((e,t)=>i(e,t,n)));for(const e of l)r(e,t,n)?(s=e,a||(a=e)):(s&&o.push([a,s]),s=null,a=null);a&&o.push([a,null]);const u=[];for(const[e,t]of o)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");const c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},2199:(e,t,n)=>{const r=n(7374),i=n(3134),{ANY:o}=i,a=n(9845),s=n(3992),l=[new i(">=0.0.0-0")],u=[new i(">=0.0.0")],c=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===o){if(1===t.length&&t[0].semver===o)return!0;e=n.includePrerelease?l:u}if(1===t.length&&t[0].semver===o){if(n.includePrerelease)return!0;t=u}const r=new Set;let i,c,m,h,g,f,v;for(const t of e)">"===t.operator||">="===t.operator?i=d(i,t,n):"<"===t.operator||"<="===t.operator?c=p(c,t,n):r.add(t.semver);if(r.size>1)return null;if(i&&c){if(m=s(i.semver,c.semver,n),m>0)return null;if(0===m&&(">="!==i.operator||"<="!==c.operator))return null}for(const e of r){if(i&&!a(e,String(i),n))return null;if(c&&!a(e,String(c),n))return null;for(const r of t)if(!a(e,String(r),n))return!1;return!0}let b=!(!c||n.includePrerelease||!c.semver.prerelease.length)&&c.semver,y=!(!i||n.includePrerelease||!i.semver.prerelease.length)&&i.semver;b&&1===b.prerelease.length&&"<"===c.operator&&0===b.prerelease[0]&&(b=!1);for(const e of t){if(v=v||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,i)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),">"===e.operator||">="===e.operator){if(h=d(i,e,n),h===e&&h!==i)return!1}else if(">="===i.operator&&!a(i.semver,String(e),n))return!1;if(c)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if(g=p(c,e,n),g===e&&g!==c)return!1}else if("<="===c.operator&&!a(c.semver,String(e),n))return!1;if(!e.operator&&(c||i)&&0!==m)return!1}return!(i&&f&&!c&&0!==m||c&&v&&!i&&0!==m||y||b)},d=(e,t,n)=>{if(!e)return t;const r=s(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,n)=>{if(!e)return t;const r=s(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=c(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},8384:(e,t,n)=>{const r=n(7374);e.exports=(e,t)=>new r(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},9178:(e,t,n)=>{const r=n(7374);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},9976:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},7372:(e,t,n)=>{"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n,r){if(!(this instanceof i))return new i(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=i,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)r=arguments[e],(n=this).tail=new i(r,n.tail,null,n),n.head||(n.head=n.tail),n.length++;var n,r;return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)r=arguments[e],(n=this).head=new i(r,null,n.head,n),n.tail||(n.tail=n.head),n.length++;var n,r;return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,o=this.head;null!==o&&i<e;i++)o=o.next;for(;null!==o&&i<t;i++,o=o.next)n.push(o.value);return n},r.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,o=this.tail;null!==o&&i>t;i--)o=o.prev;for(;null!==o&&i>e;i--,o=o.prev)n.push(o.value);return n},r.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,o=this.head;null!==o&&r<e;r++)o=o.next;var a,s,l,u,c=[];for(r=0;o&&r<t;r++)c.push(o.value),o=this.removeNode(o);for(null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev),r=0;r<n.length;r++)a=this,s=o,l=n[r],u=void 0,null===(u=s===a.head?new i(l,null,s,a):new i(l,s,s.next,a)).next&&(a.tail=u),null===u.prev&&(a.head=u),a.length++,o=u;return c},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n(9976)(r)}catch(e){}},7644:t=>{"use strict";t.exports=e},3305:e=>{"use strict";e.exports=t},3545:e=>{"use strict";e.exports=n},7388:e=>{"use strict";e.exports=r},346:e=>{"use strict";e.exports=i},7294:e=>{"use strict";e.exports=o},4745:e=>{"use strict";e.exports=a},7084:e=>{"use strict";e.exports=s},7399:e=>{"use strict";e.exports=l},5980:e=>{"use strict";e.exports=u},8283:e=>{"use strict";e.exports=c},2650:e=>{"use strict";e.exports=d},2729:e=>{"use strict";e.exports=p}},h={};function g(e){var t=h[e];if(void 0!==t)return t.exports;var n=h[e]={exports:{}};return m[e](n,n.exports,g),n.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var n in t)g.o(t,n)&&!g.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};return(()=>{"use strict";g.r(f),g.d(f,{plugin:()=>ti});var e=g(3305),t=g(5980),n=g.n(t),r=g(346),i=g.n(r),o=g(7294),a=g(7084),s=g(8283),l=g.n(s);const u="0",c="1",d="2",p="3",m="4",h="5",v="6",b=[{val:0,text:"Not classified"},{val:1,text:"Information"},{val:2,text:"Warning"},{val:3,text:"Average"},{val:4,text:"High"},{val:5,text:"Disaster"}],y="range_series";var E,I,w,T,O,x,P;!function(e){e.Group="group",e.Host="host",e.Application="application",e.Macro="macro",e.ItemTag="itemTag",e.Item="item",e.ItemValues="itemValues"}(E||(E={})),function(e){e.Problems="problems",e.Recent="recent",e.History="history"}(I||(I={}));class S extends e.BusEventWithPayload{}function A(e){return n().forEach(e,(e=>(e.item=e.name,e.name=function(e,t){const r=function(e){const t=[];let r=!1,i=!1,o="";return n().forEach(e,(e=>{'"'===e&&i?o+=e:'"'===e&&r?r=!1:'"'!==e||r?"["!==e||r?"]"!==e||r?","!==e||r||i?o+=e:(t.push(o),o=""):i=!1:i=!0:r=!0})),t.push(o),t}(t.substring(t.indexOf("[")+1,t.lastIndexOf("]")));for(let t=r.length;t>=1;t--)e=e.replace("$"+t,r[t-1]);return e}(e.item,e.key_),e))),e}O="zbx-query-updated",(T="type")in(w=S)?Object.defineProperty(w,T,{value:O,enumerable:!0,configurable:!0,writable:!0}):w[T]=O,function(e){e.UserLogin="userLogin",e.Token="token"}(x||(x={})),function(e){e.AndOr="0",e.Or="2"}(P||(P={}));const D=/{\$[A-Z0-9_\.]+}/g;function C(e,t,r){let i=r?e.url:e.name;const o=i.match(D);return n().forEach(o,(o=>{const a=n().filter(t,(t=>{if(t.hostid){if(r){let r=!1;return n().forEach(e.hosts,(e=>{e.hostid===t.hostid&&(r=!0)})),r}return t.hostid===e.hostid}return!0})),s=n().find(a,{macro:o});if(s&&s.value){const e=s.value,t=new RegExp(function(e){return e=e.replace(/\$/,"\\$")}(o));i=i.replace(t,e)}})),i}function j(e){let t;const r=[];n().each(function(e){const t=/\{[^\{\}]*\}|\{\/.*\/\}/g;let r;if(function(e){return/^\{.+\}$/.test(e)}(e)){const i=e.match(t);r=n().map(i,(e=>n().trim(e,"{}")))}else r=e.split(".");return r}(e),(e=>{"*"===e&&(e="/.*/"),r.push(e)}));const i=n().zipObject(["group","host","app","item"],r);switch(4===r.length&&"/.*/"===i.app&&(i.app=""),r.length){case 1:t=E.Group;break;case 2:t=E.Host;break;case 3:t=E.Application;break;case 4:t=E.Item}return{queryType:t,group:i.group||"",host:i.host||"",application:i.app||"",item:i.item||""}}const R=/^\/(.*)\/([gmi]*)$/m;function F(e){return R.test(e)}function $(t){const n=t.to.diff(t.from),r=Math.round(n/1e3),i=e.rangeUtil.secondsToHms(n/1e3);return{__range_ms:{text:n,value:n},__range_s:{text:r,value:r},__range:{text:i,value:i},__range_series:{text:y,value:y}}}function N(e){const t=e.match(R),n=t[1],r=""!==t[2]?t[2]:void 0;return new RegExp(n,r)}function L(e){return e.replace(/[\\^$*+?.()|[\]{}\/]/g,"\\$&")}function k(e){const t=function(e){const t=/(^[\d]+)(y|M|w|d|h|m|s)?/g.exec(e);return!t||!e||t.length>2&&!t[2]?"":t[1]+(t.length>2?t[2]:"s")}(e);return t?_(t):0}function _(e){const t=/(^[\d]+)(y|M|w|d|h|m|s)/g.exec(e);return l().duration(Number(t[1]),t[2]).valueOf()}function M(e){return function(t){for(let n=0;n<e.length;n++)t=e[n].call(this,t);return t}}function V(e){return e.replace(/\s+/g," ").trim()}function q(e){if(!e)return[];let t=n().map(e.split(","),(e=>e.trim()));return t=n().map(t,(e=>{var t,n;const r=e.split(":");return{tag:null===(t=r[0])||void 0===t?void 0:t.trim(),value:null===(n=r[1])||void 0===n?void 0:n.trim()}})),t}function B(e){const t={tag:"",value:""},n=e.indexOf(":");return n>0?(t.tag=e.slice(0,n).trim(),t.value=e.slice(Math.min(n+1,e.length)).trim()):t.tag=e.trim(),t}function H(e){return e.value?`${e.tag}: ${e.value}`:e.tag}function z(e){return e||[]}const W={"%":"percent",b:"decbits",bps:"bps",B:"bytes",Bps:"binBps",uptime:"dtdhms",qps:"qps",iops:"iops",Hz:"hertz",V:"volt",C:"celsius",RPM:"rotrpm",dBm:"dBm"},G=(()=>{const t={},n=(0,e.getValueFormats)();for(const e of n)for(const n of e.submenu){const e=n.value;t[e]=e}return t})();function U(e){let t=W[e];return t||(t=G[e]),t}function Q(e,t,n){if(null===e||e.length<2||n>e.length-1||n<0||t>e.length-1||t<0)return e;const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=i===t?e[n]:i===n?e[t]:e[i];return r}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){X(e,t,n[t])}))}return e}function Y(e){return e.resultFormat=e.resultFormat||"time_series",function(e){return!(e.mode&&0!==e.mode&&2!==e.mode||!(e.hostFilter||e.itemFilter||e.downsampleFunction||e.host&&e.host.host)||void 0!==e.item.filter||void 0!==e.host.filter)}(e=function(e){return e.group&&Array.isArray(e.group)&&(e.group={filter:""}),e}(e))?function(e){return e.group.filter="*"===e.group.name?"/.*/":e.group.name,e.host.filter="*"===e.host.name?J(e.hostFilter):e.host.name,e.application.filter="*"===e.application.name?"":e.application.name,e.item.filter="All"===e.item.name?J(e.itemFilter):e.item.name,e.macro.filter="*"===e.macro.macro?J(e.macroFilter):e.macro.macro,e}(e):(function(e){if(e.functions)for(const t of e.functions)t.def&&"percentil"===t.def.name&&(t.def.name="percentile")}(e),function(e){var t;void 0===e.queryType&&("Metrics"===e.mode?e.queryType=u:void 0!==e.mode&&(e.queryType=e.mode,delete e.mode)),"number"==typeof e.queryType&&(e.queryType=null===(t=e.queryType)||void 0===t?void 0:t.toString())}(e),function(e){e.queryType!==c||e.slaInterval||(e.slaInterval="none")}(e),function(e){var t;"priority"===(null===(t=e.options)||void 0===t?void 0:t.sortProblems)&&(e.options.sortProblems="severity")}(e),function(e){var t,n;e.itemTag||(e.itemTag={filter:""},(null===(t=e.application)||void 0===t?void 0:t.filter)&&(e.itemTag.filter=`Application: ${null===(n=e.application)||void 0===n?void 0:n.filter}`))}(e),function(e){var t,n;(null===(t=e.slaProperty)||void 0===t?void 0:t.property)&&(e.slaProperty=null===(n=e.slaProperty)||void 0===n?void 0:n.property)}(e),function(e){var t,n,r,i;(null===(t=e.triggers)||void 0===t?void 0:t.minSeverity)&&(e.options.minSeverity=null===(r=e.triggers)||void 0===r?void 0:r.minSeverity,delete e.triggers.minSeverity),(null===(n=e.triggers)||void 0===n?void 0:n.count)&&(e.options.count=null===(i=e.triggers)||void 0===i?void 0:i.count,delete e.triggers.count)}(e),function(e){e.schema>=11||("6"===e.queryType?(e.queryType=m,e.countTriggersBy="items"):"7"===e.queryType?(e.queryType=m,e.countTriggersBy="problems"):"8"===e.queryType&&(e.queryType=v))}(e),function(e){var t,n;e.schema>=12||(null===(n=e)||void 0===n||null===(t=n.options)||void 0===t?void 0:t.minSeverity)&&(e.options.severities=[0,1,2,3,4,5].filter((t=>t>=e.options.minSeverity)))}(e),e.schema=12,e)}function J(e){return e?"/"+e+"/":"/.*/"}const K=e=>{var t;const n=(e=>{var t,n,r,i,o,a,s,l;return{group:{filter:null!==(t=e.group)&&void 0!==t?t:""},host:{filter:null!==(n=e.host)&&void 0!==n?n:""},application:{filter:null!==(r=e.application)&&void 0!==r?r:""},trigger:{filter:null!==(i=e.trigger)&&void 0!==i?i:""},options:{minSeverity:null!==(o=e.minseverity)&&void 0!==o?o:0,showOkEvents:null!==(a=e.showOkEvents)&&void 0!==a&&a,hideAcknowledged:null!==(s=e.hideAcknowledged)&&void 0!==s&&s,showHostname:null!==(l=e.showHostname)&&void 0!==l&&l}}})(e);return e.target=(r=Z({},n,e.target),i=null!=(i={fromAnnotations:!0,options:Z({},n.options,null===(t=e.target)||void 0===t?void 0:t.options)})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(i)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})),r),e;var r,i};function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const te={},ne={Transform:[],Aggregate:[],Filter:[],Trends:[],Time:[],Alias:[],Special:[]};function re(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],e.category&&ne[e.category].push(e),te[e.name]=e,te[e.shortName||e.name]=e}re({name:"groupBy",category:"Transform",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),re({name:"scale",category:"Transform",params:[{name:"factor",type:"float",options:[100,.01,10,-1]}],defaultParams:[100]}),re({name:"offset",category:"Transform",params:[{name:"delta",type:"float",options:[-100,100]}],defaultParams:[100]}),re({name:"delta",category:"Transform",params:[],defaultParams:[]}),re({name:"rate",category:"Transform",params:[],defaultParams:[]}),re({name:"movingAverage",category:"Transform",params:[{name:"factor",type:"int",options:[6,10,60,100,600]}],defaultParams:[10]}),re({name:"exponentialMovingAverage",category:"Transform",params:[{name:"smoothing",type:"float",options:[6,10,60,100,600]}],defaultParams:[.2]}),re({name:"percentile",category:"Transform",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),re({name:"removeAboveValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),re({name:"removeBelowValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),re({name:"transformNull",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),re({name:"aggregateBy",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),re({name:"sumSeries",category:"Aggregate",params:[],defaultParams:[]}),re({name:"percentileAgg",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),re({name:"top",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),re({name:"bottom",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),re({name:"sortSeries",category:"Filter",params:[{name:"direction",type:"string",options:["asc","desc"]}],defaultParams:["asc"]}),re({name:"trendValue",category:"Trends",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),re({name:"timeShift",category:"Time",params:[{name:"interval",type:"string",options:["24h","7d","1M","+24h","-24h"]}],defaultParams:["24h"]}),re({name:"setAlias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:[]}),re({name:"setAliasByRegex",category:"Alias",params:[{name:"aliasByRegex",type:"string"}],defaultParams:[]}),re({name:"replaceAlias",category:"Alias",params:[{name:"regexp",type:"string"},{name:"newAlias",type:"string"}],defaultParams:["/(.*)/","$1"]}),re({name:"consolidateBy",category:"Special",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),n().each(ne,((e,t)=>{ne[t]=n().sortBy(e,"name")}));class ie{bindFunction(e){const t=e[this.def.name];if(t){let e,r=t;for(let t=0;t<this.params.length;t++)e=this.params[t],"int"!==this.def.params[t].type&&"float"!==this.def.params[t].type||(e=Number(e)),r=n().partial(r,e);return r}throw{message:"Method not found "+this.def.name}}render(e){const t=this.def.name+"(",r=n().map(this.params,((e,t)=>{const n=this.def.params[t].type;return"int"===n||"float"===n||"value_or_series"===n||"boolean"===n||"int_or_interval"===n&&(r=e,!isNaN(parseFloat(r))&&isFinite(r))?e:"'"+e+"'";var r}));return e&&r.unshift(e),t+r.join(", ")+")"}_hasMultipleParamsInString(e,t){return-1!==e.indexOf(",")&&this.def.params[t+1]&&this.def.params[t+1].optional}updateParam(e,t){this._hasMultipleParamsInString(e,t)?n().each(e.split(","),((e,t)=>{this.updateParam(e.trim(),t)})):(""===e&&this.def.params[t].optional?this.params.splice(t,1):this.params[t]=e,this.updateText())}updateText(){if(0===this.params.length)return void(this.text=this.def.name+"()");let e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}constructor(e,t){ee(this,"def",void 0),ee(this,"params",void 0),ee(this,"text",void 0),ee(this,"added",void 0),this.def=e,t?this.params=t:(this.params=[],this.params=e.defaultParams.slice(0)),this.updateText()}}function oe(e,t){if(n().isString(e)){if(!te[e])throw{message:"Method not found "+name};e=te[e]}return new ie(e,t)}function ae(){return ne}var se=g(3545);function le(e,t){return new RegExp(t).exec(e)[0]}const ue={timeShift:function(e,t){const r=function(e){const t=/^([\+\-]*)([\d]+)(y|M|w|d|h|m|s)/g.exec(e);let n=0;return n="+"===t[1]?0-l().duration(Number(t[2]),t[3]).valueOf():l().duration(Number(t[2]),t[3]).valueOf(),n}(e)/1e3;return n().map(t,(e=>e-r))},setAlias:function(t,n){var r;if((null===(r=n.fields)||void 0===r?void 0:r.length)<=2){var i,o,a;const r=n.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));var s,l,u;return(null===(a=r)||void 0===a||null===(o=a.config)||void 0===o||null===(i=o.custom)||void 0===i?void 0:i.scopedVars)&&(t=(0,se.getTemplateSrv)().replace(t,null===(u=r)||void 0===u||null===(l=u.config)||void 0===l||null===(s=l.custom)||void 0===s?void 0:s.scopedVars)),r&&(r.config.displayNameFromDS=t),n.name=t,n}for(let r=0;r<n.fields.length;r++){const i=n.fields[r];var c,d,p,m,h,g;if(i.type!==e.FieldType.time)(null===(p=i)||void 0===p||null===(d=p.config)||void 0===d||null===(c=d.custom)||void 0===c?void 0:c.scopedVars)&&(t=(0,se.getTemplateSrv)().replace(t,null===(g=i)||void 0===g||null===(h=g.config)||void 0===h||null===(m=h.custom)||void 0===m?void 0:m.scopedVars)),i.config.displayNameFromDS=t}return n},setAliasByRegex:function(t,n){var r;if((null===(r=n.fields)||void 0===r?void 0:r.length)<=2){const r=n.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));try{var i;r&&(r.config.displayNameFromDS=le(null===(i=r.config)||void 0===i?void 0:i.displayNameFromDS,t)),n.name=le(n.name,t)}catch(e){var o;console.error("Failed to apply RegExp:",(null===(o=e)||void 0===o?void 0:o.message)||e)}return n}for(const r of n.fields)if(r.type!==e.FieldType.time)try{var a;r.config.displayNameFromDS=le(null===(a=r.config)||void 0===a?void 0:a.displayNameFromDS,t)}catch(e){var s;console.error("Failed to apply RegExp:",(null===(s=e)||void 0===s?void 0:s.message)||e)}return n},replaceAlias:function(t,n,r){var i;let o;if(o=F(t)?N(t):t,(null===(i=r.fields)||void 0===i?void 0:i.length)<=2){var a,s;let t=r.name.replace(o,n);const i=r.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));var l,u;return(null===(s=i)||void 0===s||null===(a=s.state)||void 0===a?void 0:a.scopedVars)&&(t=(0,se.getTemplateSrv)().replace(t,null===(u=i)||void 0===u||null===(l=u.state)||void 0===l?void 0:l.scopedVars)),i&&(i.config.displayNameFromDS=t),r.name=t,r}for(const t of r.fields)if(t.type!==e.FieldType.time){var c,d,p,m;let e=null===(d=t.config)||void 0===d||null===(c=d.displayNameFromDS)||void 0===c?void 0:c.replace(o,n);var h,g;(null===(m=t)||void 0===m||null===(p=m.state)||void 0===p?void 0:p.scopedVars)&&e&&(e=(0,se.getTemplateSrv)().replace(e,null===(g=t)||void 0===g||null===(h=g.state)||void 0===h?void 0:h.scopedVars)),t.name=e||t.name}return r}},ce={get metricFunctions(){return ue}};var de=g(4745),pe=g.n(de);function me(e,t,r,i){const o=n().groupBy(e,"itemid"),a=n().uniqBy(n().flatten(n().map(t,"hosts")),"hostid");return n().map(o,((e,o)=>{const s=n().find(t,{itemid:o});let l=s.name;const u={__zbx_item:{value:s.name},__zbx_item_name:{value:s.name},__zbx_item_key:{value:s.key_},__zbx_item_interval:{value:s.delay}};if(n().keys(a).length>0){const e=n().find(a,{hostid:s.hostid});u.__zbx_host={value:e.host},u.__zbx_host_name={value:e.name},n().keys(a).length>1&&r&&(l=e.name+": "+l)}return{target:l,datapoints:n().map(e,i),scopedVars:u,item:s}}))}function he(e,t){let n=t.value;return e.textFilter&&(n=ge(t.value,e.textFilter,e.useCaptureGroups)),[n,1e3*t.clock+Math.round(t.ns/1e6)]}function ge(e,t,n){const r=new RegExp(t).exec(e);return r?n?r[1]:r[0]:""}function fe(e){switch(e){case"sla":return"sli";case"okTime":return"uptime";case"downtimeTime":return"downtime";default:return e}}function ve(e){return[Number(e.value),1e3*e.clock+Math.round(e.ns/1e6)]}function be(e,t){let n;switch(e){case"min":n=t.value_min;break;case"max":n=t.value_max;break;case"avg":default:n=t.value_avg;break;case"sum":n=t.value_avg*t.num;break;case"count":n=t.num}return[Number(n),1e3*t.clock]}const ye=function(e,t,n=!0){return me(e,t,n,ve)},Ee=function(e,t,r,i=!0){return me(e,t,i,n().partial(be,r))},Ie=function(e,t,r,i=!0){return me(e,t,i,n().partial(he,r))},we=function(t,n){const r=new e.MutableDataFrame({refId:n.refId,name:"macros",fields:[{name:"Host",type:e.FieldType.string},{name:"Macros",type:e.FieldType.string},{name:e.TIME_SERIES_VALUE_FIELD_NAME,type:e.FieldType.string}]});for(let n=0;n<t.length;n++){const i=t[n],o={Host:i.hosts[0].name,Macros:i.macro,[e.TIME_SERIES_VALUE_FIELD_NAME]:i.value};r.add(o)}return r},Te=function(e,t,r){const i=new(pe());i.addColumn({text:"Host"}),i.addColumn({text:"Item"}),i.addColumn({text:"Key"}),i.addColumn({text:"Last value"});const o=n().groupBy(e,"itemid");return n().each(t,(e=>{const t=o[e.itemid]||[],a=n().last(t);let s=a?a.value:null;if(r.options.skipEmptyValues&&(!s||""===s))return;r.textFilter&&(s=ge(s,r.textFilter,r.useCaptureGroups));let l=n().first(e.hosts);l=l?l.name:"",i.rows.push([l,e.name,e.key_,s])})),i},Oe=function(e,t,n){const r=n[e.serviceid].sla;if("status"===t){const i=parseInt(n[e.serviceid].status,10);return{target:e.name+" "+t,datapoints:[[i,1e3*r[0].to]]}}{let n;const i=[];for(n=0;n<r.length;n++)0===n&&i.push([r[n][t],1e3*r[n].from]),i.push([r[n][t],1e3*r[n].to]);return{target:e.name+" "+t,datapoints:i}}},xe=function(t,r,i,o){if(n().isArray(t)){var a,s;const i=function(e){const t=n().uniq(n().flattenDeep(n().map(e,(e=>n().map(e.groups,"name"))))),r={};return n().each(t,(e=>{r[e]={0:0,1:0,2:0,3:0,4:0,5:0}})),n().each(e,(e=>{n().each(e.groups,(t=>{r[t.name][e.priority]++}))})),r}(t),l=new e.MutableDataFrame({name:`Triggers ${o.refId}`,refId:o.refId,fields:[{name:"Host group",type:e.FieldType.string,values:new e.ArrayVector}]});for(let t=b.length-1;t>=0;t--)l.fields.push({name:b[t].text,type:e.FieldType.number,config:{unit:"none",decimals:0},values:new e.ArrayVector});return null===(s=null===(a=r)||void 0===a?void 0:a.map((e=>e.name)))||void 0===s||s.forEach((e=>{l.add({"Host group":e,Disaster:i[e]?i[e][5]:0,High:i[e]?i[e][4]:0,Average:i[e]?i[e][3]:0,Warning:i[e]?i[e][2]:0,Information:i[e]?i[e][1]:0,"Not classified":i[e]?i[e][0]:0})})),l}{let n=null;try{n=Number(t)}catch(e){console.log("Error when handling triggers count: ",e)}return new e.MutableDataFrame({name:`Count ${o.refId}`,refId:o.refId,fields:[{name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,values:new e.ArrayVector([1e3*i[1]])},{name:e.TIME_SERIES_VALUE_FIELD_NAME,type:e.FieldType.number,values:new e.ArrayVector([n])}],length:1})}},Pe=function(e){return n().forEach(e,(e=>{e.datapoints=n().sortBy(e.datapoints,(e=>e[1]))})),e},Se=function(t,n,r,i){const{datapoints:o,scopedVars:a,target:s,item:l}=t,u={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(o.map((e=>e[1])))};let c;e.FieldType.string,c=new e.ArrayVector(o.map((e=>e[0])));const d={name:e.TIME_SERIES_VALUE_FIELD_NAME,type:null!=i?i:e.FieldType.number,labels:{},config:{displayNameFromDS:s,custom:{}},values:c};var p,m,h,g,f;if(a&&(u.config.custom={itemInterval:null===(p=a.__zbx_item_interval)||void 0===p?void 0:p.value},d.labels={host:null===(m=a.__zbx_host_name)||void 0===m?void 0:m.value,item:null===(h=a.__zbx_item)||void 0===h?void 0:h.value,item_key:null===(g=a.__zbx_item_key)||void 0===g?void 0:g.value},d.config.custom={itemInterval:null===(f=a.__zbx_item_interval)||void 0===f?void 0:f.value}),l){var v;const t=U(l.units);t&&(console.log(`Datasource: unit detected: ${t} (${l.units})`),d.config.unit=t,"percent"===t&&(d.config.min=0,d.config.max=100));const i=function(t,n){var r;const{valuemapid:i}=t,o=null===(r=n)||void 0===r?void 0:r.find((e=>e.valuemapid===i));return o?o.mappings.map(((t,n)=>({type:e.MappingType.ValueToText,options:{value:t.value,text:t.newvalue}}))):null}(l,r);i&&(null===(v=n.options)||void 0===v?void 0:v.useZabbixValueMapping)&&(console.log("Datasource: using Zabbix value mapping"),d.config.mappings=i)}const b=[u,d],y={name:s,refId:n.refId,fields:b,length:o.length};return new e.MutableDataFrame(y)},Ae=function(t,r,i){const o=[];if(0===t.length)return[];for(const s of t){const t=(0,e.dataFrameFromJSON)(s),{timeField:l,timeIndex:u}=(0,e.getTimeField)(t);for(let e=0;e<t.fields.length;e++){var a;const s=t.fields[e];if(e===u||!s.values||!s.values.length)continue;const c=[];for(let e=0;e<s.values.length;e++){const t=s.values.get(e);null!==t&&c.push({time:l.values.get(e)/1e3,value:t})}const d=s.name,p=n().find(r,{itemid:d});let m=1e6*i.intervalMs;const h=1e6*k(p.delay);m=Math.max(m,h),0===m&&(m=null);let g=p.name;(null===(a=p.hosts)||void 0===a?void 0:a.length)>0&&(g=`${p.hosts[0].name}: ${g}`);const f={ts:c,meta:{name:g,item:p,interval:m}};o.push(f)}}return o},De=function(e,t){const n=[];if(0===e.length)return[];for(const r of e){const e=[];if(!r.datapoints)continue;const i=r.datapoints;for(let t=0;t<i.length;t++)e.push({time:i[t][1]/1e3,value:i[t][0]});let o=1e6*k(t);0===o&&(o=null);const a={ts:e,meta:{name:r.target,interval:null,item:{}}};n.push(a)}return n},Ce=function(t){if(!t||t.length<2)return!1;const n=t[0].fields.find((t=>t.type===e.FieldType.time));if(!n)return!1;for(let r=1;r<t.length;r++){const i=t[r].fields.find((t=>t.type===e.FieldType.time));for(let e=0;e<Math.min(t.length,2);e++)if(i.values.get(e)!==n.values.get(e))return!1}return!0},je=function(t){const n=function(t){let n=0,r=0;for(let i=0;i<t.length;i++){const o=t[i].fields.find((t=>t.type===e.FieldType.time));o.values.length>r&&(r=o.values.length,n=i)}return n}(t),r=t[n].fields.find((t=>t.type===e.FieldType.time));if(!r)return[];const i=[r];for(let n=0;n<t.length;n++){const o=t[n].fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME));o&&(o.name=t[n].name,r.values.length-o.values.length==1&&o.values.add(null),i.push(o))}return[{name:"wide",fields:i,length:r.values.length}]},Re=function(t){if(!t||0===t.length)return t;let n=t[0].fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)).values.get(0);for(let r=0;r<t.length;r++){const i=t[r].fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)).values.get(0);i<n&&(n=i)}for(let i=0;i<t.length;i++){const o=t[i],a=o.fields.find((t=>t.name===e.TIME_SERIES_TIME_FIELD_NAME)),s=o.fields.find((t=>t.name===e.TIME_SERIES_VALUE_FIELD_NAME)),l=a.values.get(0);if(l>n){var r;console.log("Data frames: adding missing points");let t=a.values.toArray(),i=s.values.toArray();const o=[],u=[],c=null===(r=a.config.custom)||void 0===r?void 0:r.itemInterval;for(let e=n;e<l;e+=c)o.push(e),u.push(null);t=o.concat(t),i=u.concat(i),a.values=new e.ArrayVector(t),s.values=new e.ArrayVector(i)}}return t},Fe=function(e){for(let n=0;n<e.data.length;n++){const r=e.data[n];for(const e of r.fields){var t;const n=null===(t=e.config.custom)||void 0===t?void 0:t.units;if(n){const t=U(n);t&&(e.config.unit=t,"percent"===t&&(e.config.min=0,e.config.max=100))}}}return e};function $e(e,t){const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=t[Number(i.objectid)];if(o){const e={timestamp:Number(i.clock),triggerid:i.objectid,eventid:i.eventid,name:i.name,severity:i.severity,acknowledged:i.acknowledged,acknowledges:i.acknowledges,tags:i.tags,suppressed:i.suppressed,suppression_data:i.suppression_data,description:i.name||o.description,comments:o.comments,value:o.value,opdata:i.opdata,groups:o.groups,hosts:o.hosts,items:o.items,alerts:o.alerts,url:o.url,expression:o.expression,correlation_mode:o.correlation_mode,correlation_tag:o.correlation_tag,manual_close:o.manual_close,state:o.state,error:o.error};n.push(e)}}return n}function Ne(e,t,n){const{valueFromEvent:r}=n,i=[];for(let n=0;n<e.length;n++){const o=e[n],a=t[Number(o.objectid)];if(a){const e={value:r?o.value:a.value,timestamp:Number(o.clock),triggerid:o.objectid,eventid:o.eventid,name:o.name,severity:o.severity,acknowledged:o.acknowledged,acknowledges:o.acknowledges,tags:o.tags,suppressed:o.suppressed,description:a.description,comments:a.comments,groups:a.groups,hosts:a.hosts,items:a.items,alerts:a.alerts,url:a.url,expression:a.expression,correlation_mode:a.correlation_mode,correlation_tag:a.correlation_tag,manual_close:a.manual_close,state:a.state,error:a.error};i.push(e)}}return i}const Le=function(e,t){return n().each(e,(e=>{e.datasource=t.datasource})),e},ke=function(e,t){return e.forEach((e=>{if(e.hosts&&e.hosts.length){const n=e.hosts[0];if("0"!==n.proxy_hostid){const e=t[n.proxy_hostid];n.proxy=e?e.host:""}}})),e},_e=function(t,n){if(n)return t.forEach((t=>{var r;if(null===(r=t.acknowledges)||void 0===r?void 0:r.length)for(let r=0;r<t.acknowledges.length;r++){var i,o,a;const s=t.acknowledges[r];let l=n[s.userid];l||"1"!==s.userid||(l={username:"Admin"}),s.user=(null===(i=l)||void 0===i?void 0:i.username)||"",s.name=(null===(o=l)||void 0===o?void 0:o.name)||"",s.surname=(null===(a=l)||void 0===a?void 0:a.surname)||"";const u=1e3*Number(s.clock);isNaN(u)||(s.time=(0,e.dateTime)(u).format("YYYY-MM-DD HH:mm:ss"))}})),t},Me=function(e){return n().each(e,(e=>{e.hostInMaintenance=n().some(e.hosts,(e=>"1"===e.maintenance_status)),e.maintenance=!1,"1"===e.suppressed&&(e.maintenance=!0)})),e},Ve=function(e,t){return n().each(e,(e=>{e.showAckButton=t})),e},qe=function(e,t){const r=t.trigger.filter;return r&&(e=function(e,t){return F(t)?n().filter(e,(e=>N(t).test(e.description))):n().filter(e,(e=>e.description===t))}(e,r)),t.options.hostsInMaintenance||(e=n().filter(e,(e=>!e.maintenance))),e},Be=function(e,t){var r,i;return"severity"===(null===(r=t.options)||void 0===r?void 0:r.sortProblems)?e=n().orderBy(e,["severity","eventid"],["desc","desc"]):"lastchange"===(null===(i=t.options)||void 0===i?void 0:i.sortProblems)&&(e=n().orderBy(e,["timestamp","eventid"],["desc","desc"])),e},He=function(t,n){var r;const i={name:"Problems",type:e.FieldType.other,values:new e.ArrayVector(t),config:{custom:{type:"problems"}}};return{name:"problems",refId:(null===(r=n)||void 0===r?void 0:r.refId)||"A",fields:[i],length:t.length}};var ze=g(8873),We=g.n(ze);function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ue{cacheRequest(e,t,n){return function(e,t,n,r){return function(){r.cache[t]||(r.cache[t]={});const i=r.cache[t],o=Qe(arguments);return r.cacheEnabled&&!r._isExpired(i[o])?Promise.resolve(i[o].value):e.apply(n,arguments).then((e=>(void 0!==e&&(i[o]={value:e,timestamp:Date.now()}),e)))}}(e,t,n,this)}proxify(e,t,n){return this.promises[t]||(this.promises[t]={}),function(e,t,n){return function(){const r=Qe(arguments);return t[r]||(t[r]=Promise.resolve(e.apply(n,arguments).then((e=>(t[r]=null,e))).catch((e=>{throw t[r]=null,e})))),t[r]}}(e,this.promises[t],n)}proxifyWithCache(e,t,n){const r=this.proxify(e,t,n);return this.cacheRequest(r,t,n)}_isExpired(e){if(e){const t=Date.now()-e.timestamp;return!(e.timestamp&&t<this.ttl)}return!0}constructor(e){Ge(this,"cacheEnabled",void 0),Ge(this,"ttl",void 0),Ge(this,"cache",void 0),Ge(this,"promises",void 0),this.cacheEnabled=e.enabled,this.ttl=e.ttl||6e5,this.cache={},this.promises={}}}function Qe(e){return function(e){let t,n,r,i=0;if(0!==e.length)for(t=0,r=e.length;t<r;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}(JSON.stringify(e))}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ze={0:"history",1:"history_str",2:"history_log",3:"history_uint",4:"history_text"},Ye={0:"trends",3:"trends_uint"},Je={avg:"value_avg",min:"value_min",max:"value_max",sum:"num*value_avg"};class Ke{static loadDatasource(e,t){if(!t&&void 0!==e){const r=n().find((0,se.getDataSourceSrv)().getList(),{id:e});if(!r)return Promise.reject(`Data Source with ID ${e} not found`);t=r.name}return t?(0,se.getDataSourceSrv)().get(t):Promise.reject("Data Source name should be specified")}loadDBDataSource(){return Ke.loadDatasource(this.datasourceId,this.datasourceName).then((e=>(this.datasourceTypeId=e.meta.id,this.datasourceName||(this.datasourceName=e.name),this.datasourceId||(this.datasourceId=e.id),e)))}constructor(e){Xe(this,"datasourceId",void 0),Xe(this,"datasourceName",void 0),Xe(this,"datasourceTypeId",void 0),this.datasourceId=e.datasourceId,this.datasourceName=e.datasourceName,this.datasourceTypeId=null}}const et={DBConnector:Ke,DEFAULT_QUERY_LIMIT:1e4,HISTORY_TO_TABLE_MAP:Ze,TREND_TO_TABLE_MAP:Ye,consolidateByFunc:{avg:"AVG",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},consolidateByTrendColumns:Je};var tt,nt=g(7399),rt=g.n(nt);function it(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function ot(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){it(o,r,i,a,s,"next",e)}function s(e){it(o,r,i,a,s,"throw",e)}a(void 0)}))}}function at(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const st="3.0.0",lt=(null===(tt=e.rangeUtil)||void 0===tt?void 0:tt.roundInterval)||rt().roundInterval||rt().round_interval;class ut{request(e,t){return this.version?this.backendAPIRequest(e,t):this.initVersion().then((()=>this.request(e,t)))}backendAPIRequest(e,t={}){var n=this;return ot((function*(){var r,i;const o={url:n.backendAPIUrl,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{datasourceId:n.datasourceId,method:e,params:t}};return(n.requestOptions.basicAuth||n.requestOptions.withCredentials)&&(o.withCredentials=!0),n.requestOptions.basicAuth&&(o.headers.Authorization=n.requestOptions.basicAuth),null===(i=yield(0,se.getBackendSrv)().fetch(o).toPromise())||void 0===i||null===(r=i.data)||void 0===r?void 0:r.result}))()}getVersion(){return this.backendAPIRequest("apiinfo.version")}initVersion(){return this.version?Promise.resolve(this.version):(this.getVersionPromise||(this.getVersionPromise=Promise.resolve(this.getVersion().then((e=>(e?console.log(`Zabbix version detected: ${e}`):console.log(`Failed to detect Zabbix version, use default ${st}`),this.version=e||st,this.getVersionPromise=null,e))))),this.getVersionPromise)}isZabbix54OrHigher(){return We().gte(this.version,"5.4.0")}acknowledgeEvent(e,t,n,r){n||(n=We().gte(this.version,"4.0.0")?4:0);const i={eventids:e,message:t,action:n};return void 0!==r&&(i.severity=r),this.request("event.acknowledge",i)}getGroups(){return this.request("hostgroup.get",{output:["name","groupid"],sortfield:"name",real_hosts:!0})}getHosts(e){const t={output:["hostid","name","host"],sortfield:"name"};return e&&(t.groupids=e),this.request("host.get",t)}getApps(e){var t=this;return ot((function*(){if(t.isZabbix54OrHigher())return[];const n={output:"extend",hostids:e};return t.request("application.get",n)}))()}getItems(e,t,n,r){const i={output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],sortfield:"name",webitems:!0,filter:{},selectHosts:["hostid","name","host"]};if(e&&(i.hostids=e),t&&(i.applicationids=t),"num"===n&&(i.filter.value_type=[0,3]),"text"===n&&(i.filter.value_type=[1,2,4]),this.isZabbix54OrHigher()&&(i.selectTags="extend",r)){const e=r.split(",");let t=[];for(let n=0;n<e.length;n++){const r=B(e[n]);t.push({tag:r.tag,value:r.value,operator:"1"})}i.tags=t,i.evaltype=2}return this.request("item.get",i).then(A)}getItemsByIDs(e){const t={itemids:e,output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],webitems:!0,selectHosts:["hostid","name"]};return this.isZabbix54OrHigher()&&(t.selectTags="extend"),this.request("item.get",t).then((e=>A(e)))}getMacros(e){const t={output:"extend",hostids:e};return this.request("usermacro.get",t)}getUserMacros(e){const t={output:"extend",hostmacroids:e,selectHosts:["hostid","name"]};return this.request("usermacro.get",t)}getGlobalMacros(){return this.request("usermacro.get",{output:"extend",globalmacro:!0})}getLastValue(e){const t={output:["lastvalue"],itemids:e};return this.request("item.get",t).then((e=>e.length?e[0].lastvalue:null))}getHistory(e,t,r){const i=n().groupBy(e,"value_type"),o=n().map(i,((e,i)=>{const o={output:"extend",history:i,itemids:n().map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(o.time_till=r),this.request("history.get",o)}));return Promise.all(o).then(n().flatten)}getTrend_ZBXNEXT1193(e,t,r){const i=n().groupBy(e,"value_type"),o=n().map(i,((e,i)=>{const o={output:"extend",trend:i,itemids:n().map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(o.time_till=r),this.request("trend.get",o)}));return Promise.all(o).then(n().flatten)}getTrend_30(e,t,r,i){const o={output:["itemid","clock",i],itemids:n().map(e,"itemid"),time_from:t};return r&&(o.time_till=r),this.request("trend.get",o)}getITService(e){const t={output:"extend",serviceids:e};return this.request("service.get",t)}getServices(e){const t={output:"extend",serviceids:e};return this.request("service.get",t)}getSLAList(){return this.request("sla.get",{output:"extend"})}getSLA(e,t,n){const[r,i]=t;let o=[{from:r,to:i}];"auto"===n.slaInterval?o=pt(t,dt(n.intervalMs)):"none"!==n.slaInterval&&(o=pt(t,_(n.slaInterval)/1e3));const a={serviceids:e,intervals:o};return this.request("service.getsla",a)}getSLA60(e,t,n){var r=this;return ot((function*(){const[i,o]=t;let a=[{from:i,to:o}];if("auto"===n.slaInterval){const e=dt(n.intervalMs);a=pt(t,e)}else if("none"!==n.slaInterval){const e=_(n.slaInterval)/1e3;a=pt(t,e)}const s={output:"extend",serviceids:e},l=yield r.request("sla.get",s);if(0===l.length)return{};const u={slaid:l[0].slaid,serviceids:e,period_from:i,period_to:o,periods:Math.min(a.length,100)},c=yield r.request("sla.getsli",u);if(0===c.length)return{};const d={};return c.serviceids.forEach((e=>{d[e]={sla:[]}})),c.sli.forEach(((e,t)=>{e.forEach(((e,n)=>{d[c.serviceids[n]].sla.push({downtimeTime:e.downtime,okTime:e.uptime,sla:e.sli,from:c.periods[t].period_from,to:c.periods[t].period_to})}))})),d}))()}getSLI(e,t,n,r){var i=this;return ot((function*(){const[o,a]=n;let s=[{from:o,to:a}];if("auto"===r.slaInterval){const e=dt(r.intervalMs);s=pt(n,e)}else if("none"!==r.slaInterval){const e=_(r.slaInterval)/1e3;s=pt(n,e)}const l={slaid:e,serviceids:t,period_from:o,period_to:a,periods:Math.min(s.length,100)};return yield i.request("sla.getsli",l)}))()}getProblems(e,t,n,r){const{timeFrom:i,timeTo:o,recent:a,severities:s,limit:l,acknowledged:u,tags:c,evaltype:d}=r,p={output:"extend",selectAcknowledges:"extend",selectSuppressionData:"extend",selectTags:"extend",source:"0",object:"0",sortfield:["eventid"],sortorder:"DESC",evaltype:"0",groupids:e,hostids:t,applicationids:n,recent:a};return s&&(p.severities=s),void 0!==u&&(p.acknowledged=u),c&&(p.tags=c),d&&(p.evaltype=d),l&&(p.limit=l),(i||o)&&(p.time_from=i,p.time_till=o),this.request("problem.get",p).then(z)}getTriggersByIds(e){const t={output:"extend",triggerids:e,expandDescription:!0,expandData:!0,expandComment:!0,expandExpression:!0,monitored:!0,skipDependent:!0,selectGroups:["name","groupid"],selectHosts:["hostid","name","host","maintenance_status","proxy_hostid","description"],selectItems:["itemid","name","key_","lastvalue"],preservekeys:"1"};return this.request("trigger.get",t).then(z)}getTriggers(e,t,n,r){const{showTriggers:i,maintenance:o,timeFrom:a,timeTo:s}=r,l={output:"extend",groupids:e,hostids:t,applicationids:n,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,filter:{value:1},selectGroups:["groupid","name"],selectHosts:["hostid","name","host","maintenance_status","proxy_hostid"],selectItems:["itemid","name","key_","lastvalue"],selectLastEvent:"extend",selectTags:"extend"};return i===I.Problems?l.filter.value=1:i!==I.Recent&&i!==I.History||(l.filter.value=[0,1]),o&&(l.maintenance=!0),(a||s)&&(l.lastChangeSince=a,l.lastChangeTill=s),this.request("trigger.get",l)}getEvents(e,t,n,r,i){const o={output:"extend",time_from:t,time_till:n,objectids:e,select_acknowledges:"extend",selectHosts:"extend",value:r};return i&&(o.limit=i,o.sortfield="clock",o.sortorder="DESC"),this.request("event.get",o).then(z)}getEventsHistory(e,t,n,r){const{timeFrom:i,timeTo:o,severities:a,limit:s,value:l,tags:u,evaltype:c}=r,d={output:"extend",time_from:i,time_till:o,value:"1",source:"0",object:"0",evaltype:"0",sortfield:["eventid"],sortorder:"DESC",select_acknowledges:"extend",selectTags:"extend",selectSuppressionData:["maintenanceid","suppress_until"],groupids:e,hostids:t,applicationids:n};return s&&(d.limit=s),a&&(d.severities=a),l&&(d.value=l),u&&(d.tags=u),c&&(d.evaltype=c),this.request("event.get",d).then(z)}getExtendedEventData(e){const t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",selectTags:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t)}getEventAlerts(e){const t={eventids:e,output:["alertid","eventid","message","clock","error"],selectUsers:!0};return this.request("alert.get",t)}getAcknowledges(e){const t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t).then((e=>n().filter(e,(e=>e.acknowledges.length))))}getAlerts(e,t,n){const r={output:"extend",itemids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend"};return(t||n)&&(r.lastChangeSince=t,r.lastChangeTill=n),this.request("trigger.get",r)}getHostAlerts(e,t,n){var r=this;return ot((function*(){const{minSeverity:i,acknowledged:o,tags:a,count:s,timeFrom:l,timeTo:u}=n,c={output:"extend",hostids:e,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["hostid","host","name"]};s&&1!==o&&(c.countOutput=!0,0===o&&(c.withLastEventUnacknowledged=!0)),t&&t.length&&(c.applicationids=t),(l||u)&&(c.lastChangeSince=l,c.lastChangeTill=u),a&&(c.tags=a,c.evaltype=0);let d=yield r.request("trigger.get",c);return s&&1!==o||(d=ct(d,o),s&&(d=d.length)),d}))()}getHostICAlerts(e,t,n,r){const{minSeverity:i,acknowledged:o,count:a,timeFrom:s,timeTo:l}=r,u={output:"extend",hostids:e,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"],selectItems:["name","key_"]};return a&&1!==o&&(u.countOutput=!0,0===o&&(u.withLastEventUnacknowledged=!0)),t&&t.length&&(u.applicationids=t),n&&n.length&&(u.itemids=n),(s||l)&&(u.lastChangeSince=s,u.lastChangeTill=l),this.request("trigger.get",u).then((e=>(a&&1!==o||(e=ct(e,o),a&&(e=e.length)),e)))}getHostPCAlerts(e,t,n,r){const{minSeverity:i,acknowledged:o,count:a,timeFrom:s,timeTo:l}=r,u={output:"extend",hostids:e,triggerids:n,min_severity:i,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"],selectItems:["name","key_"]};return a&&0!==o&&1!==o&&(u.countOutput=!0),t&&t.length&&(u.applicationids=t),(s||l)&&(u.lastChangeSince=s,u.lastChangeTill=l),this.request("trigger.get",u).then((e=>(a&&0!==o&&1!==o||(e=ct(e,o),a&&(e=e.length)),e)))}getProxies(){return this.request("proxy.get",{output:["proxyid","host"]})}getScripts(e,t){const n={output:"extend",hostids:e};return this.request("script.get",n).then(z)}executeScript(e,t){const n={hostid:e,scriptid:t};return this.request("script.execute",n)}getValueMappings(){return this.request("valuemap.get",{output:"extend",selectMappings:"extend"})}getUsers(){return this.request("user.get",{output:["userid","username","name","surname"]})}constructor(e,t,n){at(this,"backendAPIUrl",void 0),at(this,"requestOptions",void 0),at(this,"getTrend",void 0),at(this,"version",void 0),at(this,"getVersionPromise",void 0),at(this,"datasourceId",void 0),this.datasourceId=n,this.backendAPIUrl=`/api/datasources/${this.datasourceId}/resources/zabbix-api`,this.requestOptions={basicAuth:e,withCredentials:t},this.getTrend=this.getTrend_ZBXNEXT1193,this.initVersion()}}function ct(e,t){return 0===t?n().filter(e,(e=>"0"===e.lastEvent.acknowledged)):1===t?n().filter(e,(e=>"1"===e.lastEvent.acknowledged)):e}function dt(e){const t=lt(100*e)/1e3;return Math.max(t,3600)}function pt(e,t){let[n,r]=e;const i=[];n=Math.floor(n/t)*t,r=Math.ceil(r/t)*t;for(let e=n;e<=r-t;e+=t)i.push({from:e,to:e+t});return i}class mt{toString(){return this.name+" "+this.data}constructor(e){at(this,"code",void 0),at(this,"name",void 0),at(this,"data",void 0),at(this,"message",void 0),this.code=e.code||null,this.name=e.message||"",this.data=e.data||"",this.message="Zabbix API Error: "+this.name+" "+this.data}}const ht={historyQuery:function(e,t,n,r,i,o){const a=`clock DIV ${i} * ${i}`;return`\n      SELECT CAST(itemid AS CHAR) AS metric, ${a} AS time_sec, ${o}(value) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY ${a}, metric\n      ORDER BY time_sec ASC\n  `},trendsQuery:function(e,t,n,r,i,o,a){const s=`clock DIV ${i} * ${i}`;return`\n      SELECT CAST(itemid AS CHAR) AS metric, ${s} AS time_sec, ${o}(${a}) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY ${s}, metric\n      ORDER BY time_sec ASC\n  `},testQuery:function(){return"SELECT CAST(itemid AS CHAR) AS metric, clock AS time_sec, value_avg AS value\n          FROM trends_uint LIMIT 1"}},gt="FM99999999999999999999",ft=`\n    SELECT to_char(itemid, '${gt}') AS metric, clock AS time, value_avg AS value\n    FROM trends_uint LIMIT 1\n`,vt={historyQuery:function(e,t,n,r,i,o){return`\n      SELECT to_char(itemid, '${gt}') AS metric, clock / ${i} * ${i} AS time, ${o}(value) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `},trendsQuery:function(e,t,n,r,i,o,a){return`\n      SELECT to_char(itemid, '${gt}') AS metric, clock / ${i} * ${i} AS time, ${o}(${a}) AS value\n      FROM ${t}\n      WHERE itemid IN (${e})\n        AND clock\n          > ${n}\n        AND clock\n          < ${r}\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  `},testQuery:function(){return ft}};function bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class yt extends Ke{loadSQLDialect(){"postgres"===this.datasourceTypeId?this.sqlDialect=vt:this.sqlDialect=ht}testDataSource(){const e=this.sqlDialect.testQuery();return this.invokeSQLQuery(e)}getHistory(e,t,r,i){const{aggFunction:o,intervalSec:a}=Et(t,r,i),s=n().groupBy(e,"value_type"),l=n().map(s,((e,i)=>{const s=n().map(e,"itemid").join(", "),l=Ze[i];let u=this.sqlDialect.historyQuery(s,l,t,r,a,o);return u=V(u),this.invokeSQLQuery(u)}));return Promise.all(l).then((e=>n().flatten(e)))}getTrends(e,t,r,i){const{consolidateBy:o}=i,{aggFunction:a,intervalSec:s}=Et(t,r,i),l=n().groupBy(e,"value_type"),u=n().map(l,((e,i)=>{const l=n().map(e,"itemid").join(", "),u=Ye[i];let c=n().includes(["avg","min","max","sum"],o)?o:"avg";c=et.consolidateByTrendColumns[c];let d=this.sqlDialect.trendsQuery(l,u,t,r,s,a,c);return d=V(d),this.invokeSQLQuery(d)}));return Promise.all(u).then((e=>n().flatten(e)))}invokeSQLQuery(e){const t={refId:"A",format:"time_series",datasourceId:this.datasourceId,rawSql:e,maxDataPoints:this.limit};return(0,se.getBackendSrv)().datasourceRequest({url:"/api/ds/query",method:"POST",data:{queries:[t]}}).then((e=>{const t=e.data.results;return t.A?t.A.frames:null}))}constructor(e){super(e),bt(this,"limit",void 0),bt(this,"sqlDialect",void 0),this.limit=e.limit||1e4,this.sqlDialect=null,super.loadDBDataSource().then((()=>{this.loadSQLDialect()}))}}function Et(e,t,n){const{intervalMs:r}=n;let{consolidateBy:i}=n,o=Math.ceil(r/1e3);const a=Math.ceil((t-e)/o);return o=Math.ceil((t-e)/a),i=i||"avg",{aggFunction:et.consolidateByFunc[i],intervalSec:o}}function It(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Tt={avg:"MEAN",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"};class Ot extends Ke{testDataSource(){return this.influxDS.testDatasource().then((e=>e.status&&"error"===e.status?Promise.reject({data:{message:`InfluxDB connection error: ${e.message}`}}):e))}getHistory(t,r,i,o){const{intervalMs:a,retentionPolicy:s}=o;let{consolidateBy:l}=o;const u=Math.ceil(a/1e3),c={timeFrom:r,timeTill:i};l=l||"avg";const d=n().groupBy(t,"value_type"),p=n().map(d,((e,t)=>{const r=n().map(e,"itemid"),i=Ze[t],o=this.buildHistoryQuery(r,i,c,u,l,s);return this.invokeInfluxDBQuery(o)}));return Promise.all(p).then(n().flatten).then((t=>function(t){if(!t)return[];const n=[];for(let s=0;s<t.length;s++){const l=t[s];if(l.error){const e=`InfluxDB error: ${l.error}`;return Promise.reject(new Error(e))}if(!l||!l.series)continue;const u=t[s].series;for(let t=0;t<u.length;t++){var r,i,o,a;const l=u[t],c=[],d=[];if(l.values)for(s=0;s<l.values.length;s++)c.push(l.values[s][0]),d.push(l.values[s][1]);const p={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{},values:new e.ArrayVector(c)},m={name:null===(i=l)||void 0===i||null===(r=i.tags)||void 0===r?void 0:r.itemid,type:e.FieldType.number,config:{},values:new e.ArrayVector(d)};n.push(new e.MutableDataFrame({name:null===(a=l)||void 0===a||null===(o=a.tags)||void 0===o?void 0:o.itemid,fields:[p,m]}))}}return n.map((t=>(0,e.dataFrameToJSON)(t)))}(t)))}getTrends(e,t,n,r){return r.retentionPolicy=this.retentionPolicy,this.getHistory(e,t,n,r)}buildHistoryQuery(e,t,n,r,i,o){const{timeFrom:a,timeTill:s}=n;let l="value";return o&&(l=Je[i]||"value_avg"),V(`SELECT ${Tt[i]||i}("${l}")\n                   FROM ${o?`"${o}"."${t}"`:`"${t}"`}\n                   WHERE ${this.buildWhereClause(e)}\n                     AND "time" >= ${a}s\n                     AND "time" <= ${s}s\n                   GROUP BY time(${r}s), "itemid" fill(none)`)}buildWhereClause(e){return`(${e.map((e=>`"itemid" = '${e}'`)).join(" OR ")})`}invokeInfluxDBQuery(e){var t,n=this;return(t=function*(){var t;return(null===(t=yield n.influxDS._seriesQuery(e).toPromise())||void 0===t?void 0:t.results)||[]},function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(e){It(o,r,i,a,s,"next",e)}function s(e){It(o,r,i,a,s,"throw",e)}a(void 0)}))})()}constructor(e){super(e),wt(this,"retentionPolicy",void 0),wt(this,"influxDS",void 0),this.retentionPolicy=e.retentionPolicy,super.loadDBDataSource().then((e=>(this.influxDS=e,e)))}}function xt(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Pt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){xt(o,r,i,a,s,"next",e)}function s(e){xt(o,r,i,a,s,"throw",e)}a(void 0)}))}}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const At=["getHistory","getTrend","getGroups","getHosts","getApps","getItems","getMacros","getUMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getUserMacros","getHostICAlerts","getHostPCAlerts","getAcknowledges","getITService","getSLA","getVersion","getProxies","getEventAlerts","getExtendedEventData","getProblems","getEventsHistory","getTriggersByIds","getScripts","getValueMappings","getSLAList","getUsers"],Dt=["getGroups","getHosts","getApps","getItems","getMacros","getUMacros","getItemsByIDs","getITService","getProxies","getValueMappings","getSLAList","getUsers"],Ct=["getHistory","getTrend","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getUserMacros","getHostICAlerts","getHostPCAlerts","getAcknowledges","getITService","acknowledgeEvent","getProxies","getEventAlerts","getExtendedEventData","getScripts","executeScript","getValueMappings","getSLAList","getUsers"];class jt{initDBConnector(e,t,n){return Ke.loadDatasource(e,t).then((r=>{const i={datasourceId:e,datasourceName:t};return"influxdb"===r.type?(i.retentionPolicy=n.dbConnectionRetentionPolicy,this.dbConnector=new Ot(i)):this.dbConnector=new yt(i),this.dbConnector}))}proxifyRequests(){for(const e of At)this.zabbixAPI[e]=this.cachingProxy.proxify(this.zabbixAPI[e],e,this.zabbixAPI)}cacheRequests(){for(const e of Dt)this.zabbixAPI[e]=this.cachingProxy.cacheRequest(this.zabbixAPI[e],e,this.zabbixAPI)}bindRequests(){for(const e of Ct)this[e]=this.zabbixAPI[e].bind(this.zabbixAPI)}testDataSource(){let e,t;return this.getVersion().then((t=>(e=t,this.getAllGroups()))).then((()=>this.enableDirectDBConnection?this.dbConnector.testDataSource():Promise.resolve())).catch((e=>Promise.reject(e))).then((n=>(n&&(t={dsType:this.dbConnector.datasourceTypeName||this.dbConnector.datasourceTypeId,dsName:this.dbConnector.datasourceName}),{zabbixVersion:e,dbConnectorStatus:t})))}getVersion(){var e=this;return Pt((function*(){return e.version||(e.zabbixAPI.version?e.version=e.zabbixAPI.version:e.version=yield e.zabbixAPI.initVersion()),e.version}))()}supportsApplications(){const e=this.version||this.zabbixAPI.version;return!e||We().lt(e,"5.4.0")}supportSLA(){const e=this.version||this.zabbixAPI.version;return!e||We().gte(e,"6.0.0")}isZabbix54OrHigher(){var e=this;return Pt((function*(){const t=yield e.zabbixAPI.initVersion();return!!t&&We().gte(t,"5.4.0")}))()}isZabbix54OrHigherSync(){return!!this.version&&We().gte(this.version,"5.4.0")}getItemsFromTarget(e,t){const r=n().map(["group","host","application","itemTag","item"],(t=>e[t].filter));return this.getItems(...r,t)}getMacrosFromTarget(e){const t=n().map(["group","host","macro"],(t=>e[t].filter));return this.getUMacros(...t)}getHostsApsFromTarget(e){var t=this;return Pt((function*(){const n=["group","host","application"].map((t=>e[t].filter)),r=yield Promise.all([t.getHosts(...n),t.getApps(...n)]),i=r[0];let o=r[1];return o.appFilterEmpty&&(o=[]),[i,o]}))()}getHostsFromICTarget(e,t){var n=this;return Pt((function*(){const r=["group","host","application","itemTag","item"].map((t=>e[t].filter)),[i,o]=yield n.getHostsApsFromTarget(e);return[i,o,yield n.getItems(...r,t)]}))()}getHostsFromPCTarget(e,t){var n=this;return Pt((function*(){const r=["group","host","application","proxy","trigger"].map((t=>e[t].filter)),[i,o]=yield n.getHostsApsFromTarget(e);return[i,o,yield n.getCProblems(...r,t)]}))()}getAllGroups(){return this.zabbixAPI.getGroups()}getGroups(e){return this.getAllGroups().then((t=>Ft(t,e)))}getAllHosts(e){return this.getGroups(e).then((e=>{const t=n().map(e,"groupid");return this.zabbixAPI.getHosts(t)}))}getHosts(e,t){return this.getAllHosts(e).then((e=>Ft(e,t)))}getAllApps(e,t){var r=this;return Pt((function*(){return yield r.getVersion(),r.supportsApplications()?r.getHosts(e,t).then((e=>{const t=n().map(e,"hostid");return r.zabbixAPI.getApps(t)})):[]}))()}getApps(e,t,r){var i=this;return Pt((function*(){yield i.getVersion();const o=!i.supportsApplications();return i.getHosts(e,t).then((e=>{const t=n().map(e,"hostid");if(r&&!o)return i.zabbixAPI.getApps(t).then((e=>$t(e,r)));{const e=t;return e.hostids=t,e.appFilterEmpty=!0,Promise.resolve(e)}}))}))()}getAllMacros(e,t){var n=this;return Pt((function*(){var r;const i=null===(r=yield n.getHosts(e,t))||void 0===r?void 0:r.map((e=>e.hostid));return n.zabbixAPI.getMacros(i)}))()}getUMacros(e,t,r){var i=this;return Pt((function*(){return o=yield i.getAllMacros(e,t),F(a=r)?function(e,t){const r=N(t);return n().filter(e,(e=>{var t;return r.test(null===(t=e)||void 0===t?void 0:t.macro)}))}(o,a):function(e,t){return n().filter(e,{macro:t})||[]}(o,a);var o,a}))()}getItemTags(e,t,r){var i=this;return Pt((function*(){const o=yield i.getAllItems(e,t,null,null,{});let a=n().flatten(o.map((e=>e.tags?e.tags:[])));return a=n().uniqBy(a,(e=>e.tag+e.value||"")),Ft(a.map((e=>({name:H(e)}))),r)}))()}getAllItems(e,t,r,i,o={}){var a=this;return Pt((function*(){if(!a.isZabbix54OrHigher())return a.getAllItemsBefore54(e,t,r,i,o);const s=yield a.getHosts(e,t),l=n().map(s,"hostid");if(F(i)){const n=yield a.getItemTags(e,t,i);i=n.map((e=>e.name)).join(",")}let u=yield a.zabbixAPI.getItems(l,void 0,o.itemtype,i);return o.showDisabledItems||(u=n().filter(u,{status:"0"})),yield a.expandUserMacro(u,!1)}))()}getAllItemsBefore54(e,t,r,i,o={}){var a=this;return Pt((function*(){const i=yield a.getApps(e,t,r);let s;if(i.appFilterEmpty)s=yield a.zabbixAPI.getItems(i.hostids,void 0,o.itemtype,void 0);else{const e=n().map(i,"applicationid");s=yield a.zabbixAPI.getItems(void 0,e,o.itemtype,void 0)}return o.showDisabledItems||(s=n().filter(s,{status:"0"})),yield a.expandUserMacro(s,!1)}))()}expandUserMacro(e,t){const r=function(e){const t=n().map(e,(e=>n().map(e.hosts,"hostid")));return n().uniq(n().flatten(t))}(e);return this.getMacros(r).then((r=>(n().forEach(e,(e=>{var n;n=t?e.url:e.name,D.test(n)&&(t?e.url=C(e,r,t):e.name=C(e,r))})),e)))}getItems(e,t,n,r,i,o={}){return this.getAllItems(e,t,n,r,o).then((e=>$t(e,i)))}getItemValues(e,t,r,i,o={}){return this.getItems(e,t,r,null,i,o).then((e=>{let t=[l()().subtract(2,"h").unix(),l()().unix()];o.range&&(t=[o.range.from.unix(),o.range.to.unix()]);const[r,i]=t;return this.zabbixAPI.getHistory(e,r,i).then((e=>e?n().uniq(e.map((e=>e.value))).map((e=>({name:e}))):[]))}))}getITServices(e){var t=this;return Pt((function*(){return Ft(yield t.zabbixAPI.getITService(),e)}))()}getSLAs(e){var t=this;return Pt((function*(){return Ft(yield t.zabbixAPI.getSLAList(),e)}))()}getProblems(e,t,r,i,o){const a=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(a).then((i=>{const[o,a,s]=i,l={};return r&&(l.applicationids=n().flatten(n().map(s,"applicationid"))),t&&"/.*/"!==t&&(l.hostids=n().map(a,"hostid")),e&&(l.groupids=n().map(o,"groupid")),l})).then((e=>this.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,o))).then((e=>{var t;const n=null===(t=e)||void 0===t?void 0:t.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(n)])})).then((([e,t])=>$e(e,t))).then((e=>this.filterTriggersByProxy(e,i)))}getProblemsHistory(e,t,r,i,o){const{valueFromEvent:a}=o,s=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(s).then((i=>{const[o,a,s]=i,l={};return r&&(l.applicationids=n().flatten(n().map(s,"applicationid"))),t&&(l.hostids=n().map(a,"hostid")),e&&(l.groupids=n().map(o,"groupid")),l})).then((e=>this.zabbixAPI.getEventsHistory(e.groupids,e.hostids,e.applicationids,o))).then((e=>{var t;const n=null===(t=e)||void 0===t?void 0:t.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(n)])})).then((([e,t])=>Ne(e,t,{valueFromEvent:a}))).then((e=>this.filterTriggersByProxy(e,i)))}getCProblems(e,t,r,i,o,a){const s=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(s).then((i=>{const[o,a,s]=i,l={};return r&&(l.applicationids=n().flatten(n().map(s,"applicationid"))),t&&"/.*/"!==t&&(l.hostids=n().map(a,"hostid")),e&&(l.groupids=n().map(o,"groupid")),l})).then((e=>this.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,a))).then((e=>Ft(e,o))).then((e=>{var t;const n=null===(t=e)||void 0===t?void 0:t.map((e=>e.objectid));return Promise.all([Promise.resolve(e),this.zabbixAPI.getTriggersByIds(n)])})).then((([e,t])=>$e(e,t))).then((e=>this.filterTriggersByProxy(e,i)))}filterTriggersByProxy(e,t){return this.getFilteredProxies(t).then((n=>{if(t&&"/.*/"!==t&&e){const t=n.map((e=>e.proxyid));e=e.filter((e=>{for(let n=0;n<e.hosts.length;n++){const r=e.hosts[n];if(t.includes(r.proxy_hostid))return!0}return!1}))}return e}))}getFilteredProxies(e){return this.zabbixAPI.getProxies().then((t=>(t.forEach((e=>e.name=e.host)),Ft(t,e))))}getHistoryTS(e,t,n){const[r,i]=t;return this.enableDirectDBConnection?this.getHistoryDB(e,r,i,n).then((t=>Ae(t,e,n))):this.zabbixAPI.getHistory(e,r,i).then((t=>ye(t,e)))}getTrends(e,t,n){const[r,i]=t;if(this.enableDirectDBConnection)return this.getTrendsDB(e,r,i,n).then((t=>Ae(t,e,n)));{const t=n.consolidateBy||n.valueType;return this.zabbixAPI.getTrend(e,r,i).then((n=>Ee(n,e,t))).then(Pe)}}getHistoryText(e,t,n){const[r,i]=t;return e.length?this.zabbixAPI.getHistory(e,r,i).then((t=>"table"===n.resultFormat?Te(t,e,n):Ie(t,e,n))):Promise.resolve([])}getSLI(t,n,r,i,o){var a=this;return Pt((function*(){const s=t.map((e=>e.serviceid));if("status"===i.slaProperty)return function(t,n,r){var i;const o=[];for(let n=0;n<(null===(i=t)||void 0===i?void 0:i.length);n++){const r=t[n],i=Number(r.status);o.push({name:r?r.name:n,type:e.FieldType.number,config:{},values:new e.ArrayVector([i])})}const a={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector([Date.now()])};return new e.MutableDataFrame({refId:r.refId,name:"Service status",fields:[a,...o]})}(yield a.zabbixAPI.getServices(s),0,i);const l=n.map((e=>e.slaid));if(l.length>1){var u;const c=null===(u=l)||void 0===u?void 0:u.map((e=>a.zabbixAPI.getSLI(e,s,r,o)));return function(t,n,r,i){var o,a,s;if(!t||0===(null===(o=t)||void 0===o?void 0:o.length))return new e.MutableDataFrame({refId:i.refId,name:"SLI",fields:[]});const l=t[0],u=[];for(let e=0;e<(null===(s=l)||void 0===s||null===(a=s.periods)||void 0===a?void 0:a.length);e++){const t=l.periods[e];u.push(1e3*t.period_from)}const c={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(u)},d=[],p=fe(i.slaProperty);for(let i=0;i<t.length;i++){var m,h,g,f;const o=t[i],a=[];for(let e=0;e<(null===(h=o)||void 0===h||null===(m=h.sli)||void 0===m?void 0:m.length);e++){const t=o.sli[e];for(let e=0;e<t.length;e++){const n=t[e][p];a[e]||(a[e]=[]),a[e].push(n)}}for(let s=0;s<(null===(f=o)||void 0===f||null===(g=f.serviceids)||void 0===g?void 0:g.length);s++){var v,b;const l=null===(v=o)||void 0===v?void 0:v.serviceids[s].toString();let u=`${(null===(b=n.find((e=>e.serviceid===l)))||void 0===b?void 0:b.name)||l}`;t.length>1&&(u=`${u}: ${r[i].name}`),d.push({name:u,type:e.FieldType.number,config:{},values:new e.ArrayVector(a[s])})}}return new e.MutableDataFrame({refId:i.refId,name:"SLI",fields:[c,...d]})}(yield Promise.all(c),t,n,i)}{var c;const n=(null===(c=l)||void 0===c?void 0:c.length)>0?l[0]:void 0;return function(t,n,r){var i,o,a,s,l,u;const c=[];for(let e=0;e<(null===(o=t)||void 0===o||null===(i=o.periods)||void 0===i?void 0:i.length);e++){const n=t.periods[e];c.push(1e3*n.period_from)}const d={name:e.TIME_SERIES_TIME_FIELD_NAME,type:e.FieldType.time,config:{custom:{}},values:new e.ArrayVector(c)},p=[],m=[];let h=fe(r.slaProperty);for(let e=0;e<(null===(s=t)||void 0===s||null===(a=s.sli)||void 0===a?void 0:a.length);e++){const n=t.sli[e];for(let e=0;e<n.length;e++){const t=n[e][h];m[e]||(m[e]=[]),m[e].push(t)}}for(let r=0;r<(null===(u=t)||void 0===u||null===(l=u.serviceids)||void 0===l?void 0:l.length);r++){var g;const i=null===(g=t)||void 0===g?void 0:g.serviceids[r].toString(),o=n.find((e=>e.serviceid===i));p.push({name:o?o.name:i,type:e.FieldType.number,config:{},values:new e.ArrayVector(m[r])})}return new e.MutableDataFrame({refId:r.refId,name:"SLI",fields:[d,...p]})}(yield a.zabbixAPI.getSLI(n,s,r,o),t,i)}}))()}getSLA(e,t,r,i){var o=this;return Pt((function*(){const a=n().map(e,"serviceid");if(o.supportSLA()){const s=yield o.zabbixAPI.getSLA60(a,t,i);return n().map(a,(t=>{const i=n().find(e,{serviceid:t});return Oe(i,r.slaProperty,s)}))}const s=yield o.zabbixAPI.getSLA(a,t,i);return n().map(a,(t=>{const i=n().find(e,{serviceid:t});return Oe(i,r.slaProperty,s)}))}))()}constructor(e){St(this,"enableDirectDBConnection",void 0),St(this,"cachingProxy",void 0),St(this,"zabbixAPI",void 0),St(this,"getHistoryDB",void 0),St(this,"dbConnector",void 0),St(this,"getTrendsDB",void 0),St(this,"version",void 0),St(this,"getHistory",void 0),St(this,"getTrend",void 0),St(this,"getItemsByIDs",void 0),St(this,"getEvents",void 0),St(this,"getAlerts",void 0),St(this,"getHostAlerts",void 0),St(this,"getHostICAlerts",void 0),St(this,"getHostPCAlerts",void 0),St(this,"getAcknowledges",void 0),St(this,"getITService",void 0),St(this,"acknowledgeEvent",void 0),St(this,"getProxies",void 0),St(this,"getEventAlerts",void 0),St(this,"getExtendedEventData",void 0),St(this,"getMacros",void 0),St(this,"getUserMacros",void 0),St(this,"getValueMappings",void 0),St(this,"getSLAList",void 0),St(this,"getUsers",void 0);const{basicAuth:t,withCredentials:n,cacheTTL:r,enableDirectDBConnection:i,dbConnectionDatasourceId:o,dbConnectionDatasourceName:a,dbConnectionRetentionPolicy:s,datasourceId:l}=e;this.enableDirectDBConnection=i;const u={enabled:!0,ttl:r};if(this.cachingProxy=new Ue(u),this.zabbixAPI=new ut(t,n,l),this.proxifyRequests(),this.cacheRequests(),this.bindRequests(),i){const e={dbConnectionRetentionPolicy:s};this.initDBConnector(o,a,e).then((()=>{this.getHistoryDB=this.cachingProxy.proxifyWithCache(this.dbConnector.getHistory,"getHistory",this.dbConnector),this.getTrendsDB=this.cachingProxy.proxifyWithCache(this.dbConnector.getTrends,"getTrends",this.dbConnector)}))}}}function Rt(e,t){const r=N(t);return n().filter(e,(e=>r.test(e.name)))}function Ft(e,t){return F(t)?Rt(e,t):function(e,t){const r=n().find(e,{name:t});return r?[r]:[]}(e,t)}function $t(e,t){return F(t)?Rt(e,t):function(e,t){return n().filter(e,{name:t})||[]}(e,t)}var Nt=g(2650),Lt=g.n(Nt),kt=function(){return kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},kt.apply(this,arguments)};function _t(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var r,i,o=(0,Nt.useRef)(0),a=(r=(0,Nt.useRef)(!1),i=(0,Nt.useCallback)((function(){return r.current}),[]),(0,Nt.useEffect)((function(){return r.current=!0,function(){r.current=!1}}),[]),i),s=(0,Nt.useState)(n),l=s[0],u=s[1],c=(0,Nt.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=++o.current;return l.loading||u((function(e){return kt(kt({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return a()&&r===o.current&&u({value:e,loading:!1}),e}),(function(e){return a()&&r===o.current&&u({error:e,loading:!1}),e}))}),t);return[l,c]}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Mt=g(7388);const Vt=({children:e})=>Lt().createElement(Mt.InlineFieldRow,null,e,Lt().createElement("div",{className:"gf-form gf-form--grow"},Lt().createElement("div",{className:"gf-form-label gf-form-label--grow"})));var qt=g(7644);(0,Mt.stylesFactory)((t=>{const n=t.type===e.GrafanaThemeType.Light?"#497dc0":"#005f81",r=t.type===e.GrafanaThemeType.Light?"#456ba4":"#354f77";return{button:qt.css`
      height: 2rem;
      background-image: none;
      background-color: ${n};
      border: 1px solid ${t.palette.gray1};
      border-radius: 1px;
      color: ${t.colors.text};

      i {
        vertical-align: middle;
      }

      &:hover {
        background-color: ${r};
      }
    `,icon:qt.css`
      i {
        color: ${t.colors.text};
      }
    `}})),g(2729);Lt().createContext(se.config).Consumer,Lt().Component;const Bt=({options:e,offset:t,minWidth:n,selected:r,onSelect:i})=>{var o;const a=(0,Mt.useTheme2)(),s=(0,Mt.getSelectStyles)(a),l=(0,Mt.useStyles2)(zt(n));return Lt().createElement("div",{className:(0,qt.cx)(s.menu,l.menuWrapper,{[l.menuLeft]:t.horizontal>0},qt.css`
          bottom: ${t.vertical>0?`${t.vertical}px`:"unset"};
          top: ${t.vertical<0?`${Math.abs(t.vertical)}px`:"unset"};
        `)},Lt().createElement("div",{className:l.menu,"aria-label":"Metric picker menu"},Lt().createElement(Mt.CustomScrollbar,{autoHide:!1,autoHeightMax:"300px",hideHorizontalTrack:!0},Lt().createElement("div",null,Lt().createElement("div",{className:s.optionBody},null===(o=e)||void 0===o?void 0:o.map(((e,t)=>Lt().createElement(Ht,{data:e,key:t,onClick:i,isFocused:r===t,hideDescription:!0}))))))))},Ht=Lt().forwardRef((({data:e,isFocused:t,disabled:n,onClick:r,hideDescription:i},o)=>{const a=(0,Mt.useTheme2)(),s=(0,Mt.getSelectStyles)(a),l=(0,Mt.useStyles2)(zt()),u=(0,qt.cx)(s.option,l.menuOptionWrapper,t&&s.optionFocused,n&&l.menuOptionDisabled);return Lt().createElement("div",{ref:o,className:u,"aria-label":"Menu option",onClick:t=>{n||(t.preventDefault(),t.stopPropagation(),r(e))}},Lt().createElement("div",{className:(0,qt.cx)(s.optionBody,l.menuOptionBody)},Lt().createElement("span",null,e.label||e.value),!i&&e.description&&Lt().createElement("div",{className:s.optionDescription},e.description)),e.description&&Lt().createElement(Mt.Tooltip,{content:e.description},Lt().createElement(Mt.Icon,{name:"info-circle",className:l.menuOptionInfoSign})))}));Ht.displayName="MenuOption";const zt=e=>t=>({menuWrapper:qt.css`
      display: flex;
      max-height: 650px;
      position: absolute;
      z-index: ${t.zIndex.dropdown};
      overflow: hidden;
      min-width: auto;
    `,menu:qt.css`
      min-width: ${t.spacing(e||0)};

      & > div {
        padding-top: ${t.spacing(1)};
      }
    `,menuLeft:qt.css`
      right: 0;
      flex-direction: row-reverse;
    `,container:qt.css`
      padding: ${t.spacing(1)};
      border: 1px ${t.colors.border.weak} solid;
      border-radius: ${t.shape.borderRadius(1)};
      background-color: ${t.colors.background.primary};
      z-index: ${t.zIndex.modal};
    `,menuOptionWrapper:qt.css`
      padding: ${t.spacing(.5)};
    `,menuOptionBody:qt.css`
      font-weight: ${t.typography.fontWeightRegular};
      padding: ${t.spacing(0,1.5,0,0)};
    `,menuOptionDisabled:qt.css`
      color: ${t.colors.text.disabled};
      cursor: not-allowed;
    `,menuOptionInfoSign:qt.css`
      color: ${t.colors.text.disabled};
    `}),Wt=({value:e,options:t,isLoading:n,width:r,onChange:i})=>{const[o,a]=(0,Nt.useState)(!1),[s,l]=(0,Nt.useState)(e),[u,c]=(0,Nt.useState)(t),[d,p]=(0,Nt.useState)(-1),[m]=(0,Nt.useState)({vertical:0,horizontal:0}),h=(0,Nt.useRef)(null),g=(0,Mt.useStyles2)(Gt),f=(0,qt.cx)({[g.inputRegexp]:F(s),[g.inputVariable]:s.startsWith("$")});(0,Nt.useEffect)((()=>{c(t)}),[t]);const v=(0,Nt.useCallback)((()=>{a(!1)}),[]),b=e=>{var t;const n=(null===(t=e)||void 0===t?void 0:t.value)||"";l(n),i(n),v()};return Lt().createElement("div",{"data-testid":"role-picker",style:{position:"relative"},ref:h},Lt().createElement(Mt.ClickOutsideWrapper,{onClick:()=>o&&v()},Lt().createElement(Mt.Input,{className:f,value:s,type:"text",onChange:n=>{var r,i;o||a(!0);const s=null===(i=n)||void 0===i||null===(r=i.currentTarget)||void 0===r?void 0:r.value;if(s)if(l(s),e!==s){const e=t.filter((e=>{var t,n;return(null===(t=e.value)||void 0===t?void 0:t.toLowerCase().includes(s.toLowerCase()))||(null===(n=e.label)||void 0===n?void 0:n.toLowerCase().includes(s.toLowerCase()))}));c(e)}else c(t);else l(""),c(t)},onBlur:()=>{i(s)},onMouseDown:()=>{a(!0),c(t)},suffix:n&&Lt().createElement(Mt.Spinner,null),width:r,onKeyDown:e=>{if("ArrowDown"===e.key){o||a(!0),e.preventDefault(),e.stopPropagation();const t=d<u.length-1?d+1:0;p(t)}else if("ArrowUp"===e.key){o||a(!0),e.preventDefault(),e.stopPropagation();const t=d>0?d-1:u.length-1;p(t)}else"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),b(u[d]))}}),o&&Lt().createElement(Bt,{options:u,onSelect:b,offset:m,minWidth:r,selected:d})))},Gt=e=>({inputRegexp:qt.css`
      input {
        color: ${e.colors.warning.main};
      }
    `,inputVariable:qt.css`
      input {
        color: ${e.colors.primary.text};
      }
    `}),Ut=()=>{var e;return null===(e=(0,se.getTemplateSrv)().getVariables().filter((e=>"datasource"!==e.type&&"interval"!==e.type)))||void 0===e?void 0:e.map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};function Qt(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Xt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Qt(o,r,i,a,s,"next",e)}function s(e){Qt(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zt(e,t,n[t])}))}return e}function Jt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Kt=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],en=({annotation:e,onAnnotationChange:t,datasource:r})=>{var i,o,a,s,l,u,c;const d=(e=K(e)).target,p=(m=Xt((function*(){var e;const t=null===(e=yield r.zabbix.getAllGroups())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return t.unshift(...Ut()),t})),function(){return m.apply(this,arguments)});var m;const[{loading:h,value:g},f]=_t(Xt((function*(){return yield p()})),[]),v=function(){var e=Xt((function*(e){var t;const i=r.replaceTemplateVars(e);let o=null===(t=yield r.zabbix.getAllHosts(i))||void 0===t?void 0:t.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Ut()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:b,value:y},E]=_t(Xt((function*(){return yield v(d.group.filter)})),[d.group.filter]),I=function(){var e=Xt((function*(e,t){var i;const o=r.replaceTemplateVars(e),a=r.replaceTemplateVars(t);let s=null===(i=yield r.zabbix.getAllApps(o,a))||void 0===i?void 0:i.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Ut()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:w,value:T},O]=_t(Xt((function*(){return yield I(d.group.filter,d.host.filter)})),[d.group.filter,d.host.filter]),x=r.replaceTemplateVars(null===(i=d.group)||void 0===i?void 0:i.filter),P=r.replaceTemplateVars(null===(o=d.host)||void 0===o?void 0:o.filter);(0,Nt.useEffect)((()=>{f()}),[]),(0,Nt.useEffect)((()=>{E()}),[x]),(0,Nt.useEffect)((()=>{O()}),[x,P]);const S=n=>{t(Jt(Yt({},e),{target:n}))},A=e=>t=>{null!==t&&S(Jt(Yt({},d),{[e]:{filter:t}}))},D=e=>()=>{S(Jt(Yt({},d),{options:Jt(Yt({},d.options),{[e]:!d.options[e]})}))};return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Group",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(a=d.group)||void 0===a?void 0:a.filter,options:g,isLoading:h,onChange:A("group")})),Lt().createElement(Mt.InlineField,{label:"Host",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(s=d.host)||void 0===s?void 0:s.filter,options:y,isLoading:b,onChange:A("host")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Application",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(l=d.application)||void 0===l?void 0:l.filter,options:T,isLoading:w,onChange:A("application")})),Lt().createElement(Mt.InlineField,{label:"Problem",labelWidth:12},Lt().createElement(Mt.Input,{width:24,defaultValue:null===(u=d.trigger)||void 0===u?void 0:u.filter,placeholder:"Problem name",onBlur:("trigger",e=>{var t,n;const r=null===(n=e)||void 0===n||null===(t=n.currentTarget)||void 0===t?void 0:t.value;null!==r&&S(Jt(Yt({},d),{trigger:{filter:r}}))})}))),Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineField,{label:"Min severity",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:null===(c=d.options)||void 0===c?void 0:c.minSeverity,options:Kt,onChange:e=>{null!==e.value&&S(Jt(Yt({},d),{options:Jt(Yt({},d.options),{minSeverity:e.value})}))}})),Lt().createElement(Mt.InlineField,{label:"Show OK events",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:d.options.showOkEvents,onChange:D("showOkEvents")})),Lt().createElement(Mt.InlineField,{label:"Hide acknowledged events",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:d.options.hideAcknowledged,onChange:D("hideAcknowledged")})),Lt().createElement(Mt.InlineField,{label:"Show hostname",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:d.options.showHostname,onChange:D("showHostname")}))))};function tn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function nn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){tn(o,r,i,a,s,"next",e)}function s(e){tn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){rn(e,t,n[t])}))}return e}function an(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class sn extends e.DataSourceApi{query(t){(e=>{e.targets.forEach((t=>{const n={app:e.app};switch(t.queryType){case u:n.queryType="Metrics";break;case c:n.queryType="Services";break;case d:n.queryType="Text";break;case p:n.queryType="Item Id";break;case m:n.queryType="Triggers";break;case h:n.queryType="Problems";break;case v:n.queryType="Macros"}(0,se.reportInteraction)("grafana_zabbix_query_executed",n)}))})(t);const r=t.targets.map((e=>Y(n().cloneDeep(e)))),i=this.backendQuery(an(on({},t),{targets:r})),o=this.dbConnectionQuery(an(on({},t),{targets:r})),a=this.frontendQuery(an(on({},t),{targets:r})),s=this.annotationRequest(an(on({},t),{targets:r}));return Promise.all([i,o,a,s]).then((n=>{const[r,i,o,a]=n;return i.data&&(r.data=r.data.concat(i.data)),o.data&&(r.data=r.data.concat(o.data)),a.data&&(r.data=r.data.concat(a.data)),{data:r.data,state:e.LoadingState.Done,key:t.requestId}}))}backendQuery(e){var t=this;return nn((function*(){const{intervalMs:r,maxDataPoints:i,range:o,requestId:a}=e,s=e.targets.filter(t.isBackendTarget);e.scopedVars=Object.assign({},e.scopedVars,$(e.range));const l=n().compact(s.map((n=>n.hide?null:(t.replaceTargetVariables(n,e),an(on({},n),{datasourceId:t.datasourceId,intervalMs:r,maxDataPoints:i})))));if(!l.length)return Promise.resolve({data:[]});const u={queries:l};let c;o&&(u.range=o,u.from=o.from.valueOf().toString(),u.to=o.to.valueOf().toString());try{c=yield(0,se.getBackendSrv)().fetch({url:"/api/ds/query",method:"POST",data:u,requestId:a}).toPromise()}catch(e){return(0,se.toDataQueryResponse)(e)}const d=(0,se.toDataQueryResponse)(c);return t.sortByRefId(d),t.applyFrontendFunctions(d,e),Fe(d),Ce(d.data)&&(console.log("Converting response to the wide format"),d.data=je(d.data)),d}))()}frontendQuery(t){var r=this;return nn((function*(){const i=t.targets.filter((e=>!(r.isBackendTarget(e)||r.isDBConnectionTarget(e)))),o=n().map(i,(e=>{if(e.hide)return[];t.scopedVars=Object.assign({},t.scopedVars,$(t.range)),r.replaceTargetVariables(e,t);const n=r.buildTimeRange(t,e);return e.queryType===d?e.group&&e.host&&e.item?r.queryTextData(e,n):[]:e.queryType===c?r.queryITServiceData(e,n,t):e.queryType===m?r.queryTriggersData(e,n,t):e.queryType===h?r.queryProblems(e,n,t):e.queryType===v?r.queryUserMacrosData(e):[]}));return Promise.all(n().flatten(o)).then(n().flatten).then((t=>(t&&t.length>0&&(0,e.isDataFrame)(t[0])&&!function(t){return t.fields.length&&t.fields[0].type===e.FieldType.other&&"problems"===t.fields[0].config.custom.type}(t[0])&&!function(e){return"macros"===e.name}(t[0])&&!function(t){return!t.fields.find((t=>t.type===e.FieldType.time||t.name===e.TIME_SERIES_TIME_FIELD_NAME))}(t[0])&&(t=Re(t),Ce(t)&&(console.log("Converting response to the wide format"),t=je(t))),{data:t})))}))()}dbConnectionQuery(e){var t=this;return nn((function*(){const r=e.targets.filter(t.isDBConnectionTarget),i=n().compact(r.map((n=>{if(n.hide)return[];e.scopedVars=Object.assign({},e.scopedVars,$(e.range)),t.replaceTargetVariables(n,e);const r=t.buildTimeRange(e,n),i=t.isUseTrends(r,n);return n.queryType&&n.queryType!==u?n.queryType===p&&n.itemids?t.queryItemIdData(n,r,i,e):[]:t.queryNumericData(n,r,i,e)})));return Promise.all(i).then(n().flatten).then((e=>({data:e})))}))()}buildTimeRange(e,t){let n=Math.ceil(a.parse(e.range.from)/1e3),r=Math.ceil(a.parse(e.range.to)/1e3);const i=ln(t.functions,"Time");if(i.length){const[e,t]=M(i)([n,r]);n=e,r=t}return[n,r]}queryNumericData(e,t,n,r){var i=this;return nn((function*(){const o=yield i.zabbix.getItemsFromTarget(e,{itemtype:"num"}),a=(new Date).getTime(),s=yield i.queryNumericDataForItems(o,e,t,n,r),l=(new Date).getTime();return i.enableDebugLog&&console.log(`Datasource::Performance Query Time (${i.name}): ${l-a}`),i.handleBackendPostProcessingResponse(s,r,e)}))()}queryNumericDataForItems(e,t,r,i,o){var a=this;return nn((function*(){let s;o.valueType=a.getTrendValueType(t),o.consolidateBy=function(e){let t;const r=n().find(e.functions,(e=>"consolidateBy"===e.def.name));return r&&r.params&&r.params.length&&(t=r.params[0]),t}(t)||o.valueType,s=i?yield a.zabbix.getTrends(e,r,o):yield a.zabbix.getHistoryTS(e,r,o);const l={from:r[0],to:r[1]};return yield a.invokeDataProcessingQuery(s,t,l)}))()}invokeDataProcessingQuery(e,t,n){var r=this;return nn((function*(){const i={url:`/api/datasources/${r.datasourceId}/resources/db-connection-post`,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{series:e,query:t,timeRange:n}};return(yield(0,se.getBackendSrv)().fetch(i).toPromise()).data}))()}handleBackendPostProcessingResponse(t,n,r){const i=[];for(const n of t){const t=(0,e.dataFrameFromJSON)(n);t.refId=r.refId,i.push(t)}const o={data:i};return this.sortByRefId(o),this.applyFrontendFunctions(o,n),Ce(o.data)&&(console.log("Converting response to the wide format"),o.data=je(o.data)),o.data}getTrendValueType(e){const t=n().map(ae().Trends,"name"),r=n().find(e.functions,(e=>n().includes(t,e.def.name)));return r?r.params[0]:"avg"}sortByRefId(e){e.data.sort(((e,t)=>e.refId<t.refId?-1:e.refId>t.refId?1:0))}applyFrontendFunctions(e,t){for(let n=0;n<e.data.length;n++){const r=e.data[n];M(ln(mn(t,r.refId).functions,"Alias"))(r)}return e}queryTextData(t,n){return this.zabbix.getItemsFromTarget(t,{itemtype:"text"}).then((e=>this.zabbix.getHistoryText(e,n,t))).then((n=>"table"!==t.resultFormat?n.map((n=>Se(n,t,[],e.FieldType.string))):n))}queryItemIdData(e,t,r,i){let o=e.itemids;return o=(0,se.getTemplateSrv)().replace(o,i.scopedVars,dn),o=n().map(o.split(","),(e=>e.trim())),o?this.zabbix.getItemsByIDs(o).then((n=>this.queryNumericDataForItems(n,e,t,r,i))):[]}queryITServiceData(e,t,r){var i=this;return nn((function*(){if(e.hide||!e.itservice&&!e.itServiceFilter||!e.slaProperty)return[];let o;r.isOldVersion=e.itservice&&!e.itServiceFilter,o=r.isOldVersion?"/.*/":i.replaceTemplateVars(e.itServiceFilter,r.scopedVars),r.slaInterval=e.slaInterval;let a=yield i.zabbix.getITServices(o);var s;if(r.isOldVersion&&(a=n().filter(a,{serviceid:null===(s=e.itservice)||void 0===s?void 0:s.serviceid})),void 0!==e.slaFilter){const n=i.replaceTemplateVars(e.slaFilter,r.scopedVars),o=yield i.zabbix.getSLAs(n);return yield i.zabbix.getSLI(a,o,t,e,r)}const l=yield i.zabbix.getSLA(a,t,e,r),u=De(l,e.slaInterval),c=yield i.invokeDataProcessingQuery(u,e,{});return i.handleBackendPostProcessingResponse(c,r,e)}))()}queryUserMacrosData(e){var t=this;return nn((function*(){const r=e.group.filter,i=e.host.filter,o=e.macro.filter,a=yield t.zabbix.getUMacros(r,i,o),s=n().map(a,"hostmacroid"),l=yield t.zabbix.getUserMacros(s);return we(l,e)}))()}queryTriggersData(e,t,n){var r=this;return nn((function*(){var i,o,a;if("items"===e.countTriggersBy)return r.queryTriggersICData(e,t);if("problems"===e.countTriggersBy)return r.queryTriggersPCData(e,t,n);const[s,l]=yield r.zabbix.getHostsApsFromTarget(e);if(!s.length)return Promise.resolve([]);const u=e.group.filter,c=yield r.zabbix.getGroups(u),d=null===(i=s)||void 0===i?void 0:i.map((e=>e.hostid)),p=null===(o=l)||void 0===o?void 0:o.map((e=>e.applicationid)),m=hn(e,t),h=q(r.replaceTemplateVars(null===(a=e.tags)||void 0===a?void 0:a.filter,n.scopedVars).replace("/^","").replace("$/",""));h.forEach((e=>{e.operator=1})),h&&h.length&&(m.tags=h);const g=yield r.zabbix.getHostAlerts(d,p,m);return xe(g,c,t,e)}))()}queryTriggersICData(e,t){var n=this;return nn((function*(){var r,i,o;const[a,s,l]=yield n.zabbix.getHostsFromICTarget(e,{itemtype:"num"});if(!a.length)return Promise.resolve([]);const u=e.group.filter,c=yield n.zabbix.getGroups(u),d=null===(r=a)||void 0===r?void 0:r.map((e=>e.hostid)),p=null===(i=s)||void 0===i?void 0:i.map((e=>e.applicationid)),m=null===(o=l)||void 0===o?void 0:o.map((e=>e.itemid));if(!m.length)return Promise.resolve([]);const h=hn(e,t),g=yield n.zabbix.getHostICAlerts(d,p,m,h);return xe(g,c,t,e)}))()}queryTriggersPCData(e,t,n){var r=this;return nn((function*(){var i,o,a,s,l,u,c,d,p,m;const[h,g]=t,f=q(r.replaceTemplateVars(null===(i=e.tags)||void 0===i?void 0:i.filter,n.scopedVars).replace("/^","").replace("$/",""));f.forEach((e=>{e.operator=1}));const v={minSeverity:null===(o=e.options)||void 0===o?void 0:o.minSeverity,limit:null===(a=e.options)||void 0===a?void 0:a.limit};var b;if(f&&f.length&&(v.tags=f),(0===(null===(s=e.options)||void 0===s?void 0:s.acknowledged)||1===(null===(l=e.options)||void 0===l?void 0:l.acknowledged))&&(v.acknowledged=!!(null===(b=e.options)||void 0===b?void 0:b.acknowledged)),null===(u=e.options)||void 0===u?void 0:u.minSeverity){var y;let t=[0,1,2,3,4,5].filter((t=>{var n;return t>=(null===(n=e.options)||void 0===n?void 0:n.minSeverity)}));(null===(y=e.options)||void 0===y?void 0:y.severities)&&(t=t.filter((t=>{var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}))),v.severities=t}e.options.useTimeRange&&(v.timeFrom=h,v.timeTo=g);const[E,I,w]=yield r.zabbix.getHostsFromPCTarget(e,v);if(!E.length)return Promise.resolve([]);const T=e.group.filter,O=yield r.zabbix.getGroups(T),x=null===(c=E)||void 0===c?void 0:c.map((e=>e.hostid)),P=null===(d=I)||void 0===d?void 0:d.map((e=>e.applicationid)),S=w.map((e=>e.triggerid)),A={minSeverity:null===(p=e.options)||void 0===p?void 0:p.minSeverity,acknowledged:null===(m=e.options)||void 0===m?void 0:m.acknowledged,count:e.options.count};e.options.useTimeRange&&(A.timeFrom=h,A.timeTo=g);const D=yield r.zabbix.getHostPCAlerts(x,P,S,A);return xe(D,O,t,e)}))()}queryProblems(e,t,r){var i=this;return nn((function*(){var a,s,l,u,c,d,p,m,h,g,f,v,b,y;const[E,w]=t,T=o.contextSrv.isEditor||o.contextSrv.isGrafanaAdmin;let O=!0;const x=e.showProblems||I.Problems,P=e.options.hostProxy?i.zabbix.getProxies():()=>[];O=!i.disableReadOnlyUsersAck||T;const S=i.replaceTemplateVars(null===(a=e.group)||void 0===a?void 0:a.filter,r.scopedVars),A=i.replaceTemplateVars(null===(s=e.host)||void 0===s?void 0:s.filter,r.scopedVars),D=i.replaceTemplateVars(null===(l=e.application)||void 0===l?void 0:l.filter,r.scopedVars),C=i.replaceTemplateVars(null===(u=e.proxy)||void 0===u?void 0:u.filter,r.scopedVars),j=i.replaceTemplateVars(null===(c=e.trigger)||void 0===c?void 0:c.filter,r.scopedVars),R=i.replaceTemplateVars(null===(d=e.tags)||void 0===d?void 0:d.filter,r.scopedVars),F=an(on({},e),{trigger:{filter:j},tags:{filter:R}}),$=q(R.replace("/^","").replace("$/",""));$.forEach((e=>{e.operator=1}));const N={recent:x===I.Recent,minSeverity:null===(p=e.options)||void 0===p?void 0:p.minSeverity,limit:null===(m=e.options)||void 0===m?void 0:m.limit};var L,k;if($&&$.length&&(N.tags=$),(null===(h=e)||void 0===h?void 0:h.evaltype)&&(N.evaltype=null===(L=e)||void 0===L?void 0:L.evaltype),0!==(null===(g=e.options)||void 0===g?void 0:g.acknowledged)&&1!==(null===(f=e.options)||void 0===f?void 0:f.acknowledged)||(N.acknowledged=!!(null===(k=e.options)||void 0===k?void 0:k.acknowledged)),null===(b=e.options)||void 0===b||null===(v=b.severities)||void 0===v?void 0:v.length){let t=[0,1,2,3,4,5].filter((t=>{var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}));N.severities=t}let _;x===I.History||(null===(y=e.options)||void 0===y?void 0:y.useTimeRange)?(N.timeFrom=E,N.timeTo=w,_=i.zabbix.getProblemsHistory(S,A,D,C,N)):_=i.zabbix.getProblems(S,A,D,C,N);const M=i.zabbix.getUsers();let V,B;return Promise.all([_,P,M]).then((([e,t,r])=>(B=n().keyBy(r,"userid"),V=n().keyBy(t,"proxyid"),e))).then((e=>Me(e))).then((e=>Ve(e,O))).then((e=>qe(e,F))).then((t=>Be(t,e))).then((t=>Le(t,e))).then((e=>_e(e,B))).then((e=>ke(e,V))).then((t=>He(t,e)))}))()}testDatasource(){var e=this;return nn((function*(){try{const{zabbixVersion:t,dbConnectorStatus:n}=yield e.zabbix.testDataSource();let r=`Zabbix API version: ${t}`;return n&&(r+=`, DB connector type: ${n.dsType}`),{status:"success",title:"Success",message:r}}catch(e){return e instanceof mt?{status:"error",title:e.message,message:e.message}:e.data&&e.data.message?{status:"error",title:"Zabbix Client Error",message:e.data.message}:"string"==typeof e?{status:"error",title:"Unknown Error",message:e}:(console.log(e),{status:"error",title:"Connection failed",message:"Could not connect to given url"})}}))()}metricFindQuery(e,t){let r,i=n().cloneDeep(e);if(!e)return Promise.resolve([]);"string"==typeof e&&(i=j(e));for(const e of["group","host","application","itemTag","item"])i[e]=this.replaceTemplateVars(i[e],{});const{group:o,host:a,application:s,item:l}=i;switch(i.queryType){case E.Group:r=this.zabbix.getGroups(i.group);break;case E.Host:r=this.zabbix.getHosts(i.group,i.host);break;case E.Application:r=this.zabbix.getApps(i.group,i.host,i.application);break;case E.ItemTag:r=this.zabbix.getItemTags(i.group,i.host,i.itemTag);break;case E.Item:r=this.zabbix.getItems(i.group,i.host,i.application,null,i.item);break;case E.ItemValues:var u;const e=null===(u=t)||void 0===u?void 0:u.range;r=this.zabbix.getItemValues(o,a,s,l,{range:e});break;default:r=Promise.resolve([])}return r.then((e=>n().map(e,un)))}targetContainsTemplate(e){var t,n,r,i,o,a,s,l;const u=(0,se.getTemplateSrv)();return u.variableExists(null===(t=e.group)||void 0===t?void 0:t.filter)||u.variableExists(null===(n=e.host)||void 0===n?void 0:n.filter)||u.variableExists(null===(r=e.application)||void 0===r?void 0:r.filter)||u.variableExists(null===(i=e.itemTag)||void 0===i?void 0:i.filter)||u.variableExists(null===(o=e.item)||void 0===o?void 0:o.filter)||u.variableExists(null===(a=e.macro)||void 0===a?void 0:a.filter)||u.variableExists(null===(s=e.proxy)||void 0===s?void 0:s.filter)||u.variableExists(null===(l=e.trigger)||void 0===l?void 0:l.filter)||u.variableExists(e.textFilter)||u.variableExists(e.itServiceFilter)}annotationRequest(t){var n=this;return nn((function*(){const r=t.targets.filter((e=>e.fromAnnotations));if(!r.length)return Promise.resolve({data:[]});const i=yield n.annotationQueryLegacy(an(on({},t),{targets:r}));return{data:[(0,e.toDataFrame)(i)]}}))()}annotationQueryLegacy(e){const t=e.range||e.rangeRaw,r=Math.ceil(a.parse(t.from)/1e3),i=Math.ceil(a.parse(t.to)/1e3),o=e.targets[0],s={value:o.options.showOkEvents?["0","1"]:"1",valueFromEvent:!0,timeFrom:r,timeTo:i};if(o.options.minSeverity){const e=[0,1,2,3,4,5].filter((e=>e>=Number(o.options.minSeverity)));s.severities=e}const u=this.replaceTemplateVars(o.group.filter,{}),c=this.replaceTemplateVars(o.host.filter,{}),d=this.replaceTemplateVars(o.application.filter,{});return this.zabbix.getProblemsHistory(u,c,d,void 0,s).then((e=>{const t=this.replaceTemplateVars(o.trigger.filter,{});return F(t)?e=n().filter(e,(e=>N(t).test(e.description))):t&&(e=n().filter(e,(e=>e.description===t))),o.hideAcknowledged&&(e=n().filter(e,(e=>{var t;return!(null===(t=e.acknowledges)||void 0===t?void 0:t.length)}))),n().map(e,(e=>{const t=function(e){if(e.length){let t="<br><br>Acknowledges:<br><table><tr><td><b>Time</b></td><td><b>User</b></td><td><b>Comments</b></td></tr>";return n().each(n().map(e,(e=>"<tr><td><i>"+l().unix(e.clock).format("DD MMM YYYY HH:mm:ss")+"</i></td><td>"+e.alias+" ("+e.name+" "+e.surname+")</td><td>"+e.message+"</td></tr>")),(e=>{t=t.concat(e)})),t=t.concat("</table>"),t}return""}(e.acknowledges);let r=[];return o.showHostname&&(r=n().map(e.hosts,"name")),{title:"1"===e.value?"Problem":"OK",time:1e3*e.timestamp,annotation:o,text:e.name+t,tags:r}}))}))}replaceTargetVariables(e,t){const r=(0,se.getTemplateSrv)();n().forEach(["group","host","application","itemTag","item"],(n=>{e[n]&&e[n].filter&&(e[n].filter=this.replaceTemplateVars(e[n].filter,t.scopedVars))})),e.textFilter&&(e.textFilter=this.replaceTemplateVars(e.textFilter,t.scopedVars)),e.itemids&&(e.itemids=r.replace(e.itemids,t.scopedVars,dn)),n().forEach(e.functions,(e=>{e.params=n().map(e.params,(e=>"number"==typeof e?+r.replace(e.toString(),t.scopedVars):r.replace(e,t.scopedVars)))}))}isUseTrends(e,t){if("false"===t.options.useTrends)return!1;const[n,r]=e,i=Math.ceil(a.parse("now-"+this.trendsFrom)/1e3),o=Math.ceil(_(this.trendsRange)/1e3);return("true"===t.options.useTrends||this.trends)&&(n<i||r-n>o)}constructor(e){super(e),rn(this,"name",void 0),rn(this,"basicAuth",void 0),rn(this,"withCredentials",void 0),rn(this,"trends",void 0),rn(this,"trendsFrom",void 0),rn(this,"trendsRange",void 0),rn(this,"cacheTTL",void 0),rn(this,"disableReadOnlyUsersAck",void 0),rn(this,"disableDataAlignment",void 0),rn(this,"enableDirectDBConnection",void 0),rn(this,"dbConnectionDatasourceId",void 0),rn(this,"dbConnectionDatasourceName",void 0),rn(this,"dbConnectionRetentionPolicy",void 0),rn(this,"enableDebugLog",void 0),rn(this,"datasourceId",void 0),rn(this,"zabbix",void 0),rn(this,"replaceTemplateVars",void 0),rn(this,"isBackendTarget",(e=>!this.enableDirectDBConnection&&(e.queryType===u||e.queryType===p))),rn(this,"isDBConnectionTarget",(e=>this.enableDirectDBConnection&&(e.queryType===u||e.queryType===p))),this.enableDebugLog="development"===i().buildInfo.env,this.annotations={QueryEditor:en,prepareAnnotation:K};const t=(0,se.getTemplateSrv)();this.replaceTemplateVars=n().partial(pn,t),this.datasourceId=e.id,this.name=e.name,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials;const r=function(e){if(e||(e={}),!function(e){return!(!e.dbConnection||n().isEmpty(e.dbConnection))||!!(e.schema&&e.schema<3)}(e))return e;const t=e.schema||1;if(e.schema=3,t<2){const t=e.dbConnection||{};e.dbConnectionEnable=t.enable||!1,e.dbConnectionDatasourceId=t.datasourceId||null,delete e.dbConnection}return t<3&&(e.timeout=""===e.timeout?null:Number(e.timeout)),e}(e.jsonData);this.trends=r.trends,this.trendsFrom=r.trendsFrom||"7d",this.trendsRange=r.trendsRange||"4d";const o=r.cacheTTL||"1h";this.cacheTTL=_(o),this.disableReadOnlyUsersAck=r.disableReadOnlyUsersAck,this.disableDataAlignment=r.disableDataAlignment,this.enableDirectDBConnection=r.dbConnectionEnable||!1,this.dbConnectionDatasourceId=r.dbConnectionDatasourceId,this.dbConnectionDatasourceName=r.dbConnectionDatasourceName,this.dbConnectionRetentionPolicy=r.dbConnectionRetentionPolicy;const a={basicAuth:this.basicAuth,withCredentials:this.withCredentials,cacheTTL:this.cacheTTL,enableDirectDBConnection:this.enableDirectDBConnection,dbConnectionDatasourceId:this.dbConnectionDatasourceId,dbConnectionDatasourceName:this.dbConnectionDatasourceName,dbConnectionRetentionPolicy:this.dbConnectionRetentionPolicy,datasourceId:this.datasourceId};this.zabbix=new jt(a)}}function ln(e,t){const r=n().map(ae()[t],"name"),i=n().filter(e,(e=>n().includes(r,e.def.name)));return n().map(i,(e=>oe(e.def,e.params).bindFunction(ce.metricFunctions)))}function un(e){return{text:e.name,expandable:!1}}function cn(e){return"string"==typeof e?L(e):"("+n().map(e,L).join("|")+")"}function dn(e){return"string"==typeof e?e:e.join(",")}function pn(e,t,n){let r=e.replace(t,n,cn);return t&&t!==r&&!F(r)&&(r="/^"+r+"$/"),r}function mn(e,t){for(let n=0;n<e.targets.length;n++){const r=e.targets[n];if(r.refId===t)return r}return null}const hn=(e,t)=>{var n,r,i,o;const[a,s]=t,l={minSeverity:null===(n=e.options)||void 0===n?void 0:n.minSeverity,acknowledged:null===(r=e.options)||void 0===r?void 0:r.acknowledged,count:null===(i=e.options)||void 0===i?void 0:i.count};return(null===(o=e.options)||void 0===o?void 0:o.useTimeRange)&&(l.timeFrom=a,l.timeTo=s),l};function gn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function fn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){gn(o,r,i,a,s,"next",e)}function s(e){gn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function vn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const bn=({query:e,datasource:t,onChange:r})=>{var i,o,a,s;const l=(u=fn((function*(){var e;const n=null===(e=yield t.zabbix.getAllGroups())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n})),function(){return u.apply(this,arguments)});var u;const[{loading:c,value:d},p]=_t(fn((function*(){return yield l()})),[]),m=function(){var e=fn((function*(e){var r;const i=t.replaceTemplateVars(e);let o=null===(r=yield t.zabbix.getAllHosts(i))||void 0===r?void 0:r.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Ut()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:h,value:g},f]=_t(fn((function*(){return yield m(e.group.filter)})),[e.group.filter]),v=function(){var e=fn((function*(e,r){var i;const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r);let s=null===(i=yield t.zabbix.getAllApps(o,a))||void 0===i?void 0:i.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Ut()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:b,value:y},E]=_t(fn((function*(){return yield v(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),I=function(){var e=fn((function*(e,r){var i;if(!(yield t.zabbix.isZabbix54OrHigher()))return[];const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),s=yield t.zabbix.getAllItems(o,a,null,null,{}),l=n().flatten(s.map((e=>e.tags||[])));let u=null===(i=n().uniqBy(l,(e=>e.tag+e.value||"")).map((e=>H(e))))||void 0===i?void 0:i.map((e=>({value:e,label:e})));return u=n().uniqBy(u,(e=>e.value)),u.unshift(...Ut()),u}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:w,value:T},O]=_t(fn((function*(){return yield I(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),x=function(){var r=fn((function*(r,i,o,a){var s;const l=t.replaceTemplateVars(r),u=t.replaceTemplateVars(i),c=t.replaceTemplateVars(o),d=t.replaceTemplateVars(a),p={itemtype:"num",showDisabledItems:e.options.showDisabledItems};let m=null===(s=yield t.zabbix.getAllItems(l,u,c,d,p))||void 0===s?void 0:s.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Ut()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:P,value:S},A]=_t(fn((function*(){return yield x(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),D=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),C=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter),j=t.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter),R=t.replaceTemplateVars(null===(s=e.itemTag)||void 0===s?void 0:s.filter);(0,Nt.useEffect)((()=>{p()}),[]),(0,Nt.useEffect)((()=>{f()}),[D]),(0,Nt.useEffect)((()=>{E()}),[D,C]),(0,Nt.useEffect)((()=>{O()}),[D,C]),(0,Nt.useEffect)((()=>{A()}),[D,C,j,R]);const F=t=>n=>{var i,o;null!==n&&r((i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vn(e,t,n[t])}))}return e}({},e),o=null!=(o={[t]:{filter:n}})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(o)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})),i))},$=t.zabbix.supportsApplications();return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Group",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.group.filter,options:d,isLoading:c,onChange:F("group")})),Lt().createElement(Mt.InlineField,{label:"Host",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.host.filter,options:g,isLoading:h,onChange:F("host")}))),Lt().createElement(Vt,null,$&&Lt().createElement(Mt.InlineField,{label:"Application",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.application.filter,options:y,isLoading:b,onChange:F("application")})),!$&&Lt().createElement(Mt.InlineField,{label:"Item tag",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.itemTag.filter,options:T,isLoading:w,onChange:F("itemTag")})),Lt().createElement(Mt.InlineField,{label:"Item",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.item.filter,options:S,isLoading:P,onChange:F("item")}))))},yn=e=>Lt().createElement(Mt.Icon,{className:"pointer",name:"question-circle",onClick:()=>{window.open(`https://grafana.github.io/grafana-zabbix/reference/functions/#${e.name}`,"_blank")}}),En=e=>{const{func:t,onMoveLeft:n,onMoveRight:r,onRemove:i}=e;return Lt().createElement("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"}},Lt().createElement(Mt.Icon,{className:"pointer",name:"arrow-left",onClick:()=>n(t)}),Lt().createElement(yn,{name:t.def.name,description:t.def.description}),Lt().createElement(Mt.Icon,{className:"pointer",name:"times",onClick:()=>i(t)}),Lt().createElement(Mt.Icon,{className:"pointer",name:"arrow-right",onClick:()=>r(t)}))};function In(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const wn=e=>({icon:qt.css`
      margin-right: ${e.spacing(.5)};
    `,label:(0,qt.css)({fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.bodySmall.fontSize,cursor:"pointer",display:"inline-block"})}),Tn=e=>{var{onMoveLeft:t,onMoveRight:n,func:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["onMoveLeft","onMoveRight","func"]);const o=(0,Mt.useStyles2)(wn);return Lt().createElement(Mt.Tooltip,{content:({updatePopperPosition:e})=>{return Lt().createElement(En,(o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){In(e,t,n[t])}))}return e}({},i),a=null!=(a={func:r,onMoveLeft:()=>{t(r),e()},onMoveRight:()=>{n(r),e()}})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(a)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})),o));var o,a},placement:"top",interactive:!0},Lt().createElement("span",{className:o.label},r.def.name))};function On({editableParam:e,onChange:t,onExpandedChange:n,autofocus:r}){var i;const o=(0,Mt.useStyles2)(xn);return(null===(i=e.options)||void 0===i?void 0:i.length)>0?Lt().createElement(Mt.Segment,{autofocus:r,value:e.value,inputPlaceholder:e.name,className:o.segment,options:e.options,placeholder:" +"+e.name,onChange:e=>{t(e.value||"")},onExpandedChange:n,inputMinWidth:150,allowCustomValue:!0,allowEmptyValue:!0}):Lt().createElement(Mt.SegmentInput,{autofocus:r,className:o.input,value:e.value||"",placeholder:" +"+e.name,inputPlaceholder:e.name,onChange:e=>{t(e.toString())},onExpandedChange:n,style:{height:"25px",paddingTop:"2px",marginTop:"2px",paddingLeft:"4px",minWidth:"100px"}})}const xn=e=>({segment:(0,qt.css)({margin:0,padding:0}),input:qt.css`
    margin: 0;
    padding: 0;
    input {
      height: 25px;
    },
  `});function Pn(e,t,n){var r,i,o;return{name:e.name,value:(null===(r=n)||void 0===r?void 0:r.toString())||"",optional:!!e.optional||t,multiple:!!e.multiple,options:null!==(o=null===(i=e.options)||void 0===i?void 0:i.map((e=>({value:e.toString(),label:e.toString()}))))&&void 0!==o?o:[]}}function Sn({func:e,onMoveLeft:t,onMoveRight:n,onRemove:r,onParamChange:i}){const o=(0,Mt.useStyles2)(An),[a,s]=(0,Nt.useState)(!1),[l,u]=(0,Nt.useState)(!1);let c=function(e){var t;const n=e.def.params.map(((t,n)=>Pn(t,!1,e.params[n])));for(;n.length<e.params.length;){const t=e.def.params[e.def.params.length-1],r=e.params[n.length];n.push(Pn(t,!0,r))}if(n.length&&n[n.length-1].value&&(null===(t=n[n.length-1])||void 0===t?void 0:t.multiple)){const t=e.def.params[e.def.params.length-1];n.push(Pn(t,!0,""))}return n}(e);return c=c.filter(((t,n)=>n<e.def.params.length&&!t.optional||e.added||t.value||l||a)),Lt().createElement("div",{className:(0,qt.cx)(o.container),onMouseOver:()=>s(!0),onMouseLeave:()=>s(!1)},Lt().createElement(Mt.HorizontalGroup,{spacing:"none"},Lt().createElement(Tn,{func:e,onMoveLeft:t,onMoveRight:n,onRemove:r}),Lt().createElement(Mt.InlineLabel,{className:o.label},"("),c.map(((t,n)=>Lt().createElement(Lt().Fragment,{key:n},Lt().createElement(On,{autofocus:0===n&&e.added,editableParam:t,onChange:r=>{(""!==r||t.optional)&&i(e,n,r),u(!1),s(!1)},onExpandedChange:u}),n!==c.length-1?",":""))),Lt().createElement(Mt.InlineLabel,{className:o.label},")")))}const An=e=>({container:(0,qt.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`}),error:qt.css`
    border: 1px solid ${e.colors.error.main};
  `,label:(0,qt.css)({padding:0,margin:0}),button:(0,qt.css)({padding:e.spacing(.5)})});function Dn({onFuncAdd:e}){const[t,n]=(0,Nt.useState)(!1),r=(0,Mt.useStyles2)(Cn),i=(0,Mt.useTheme2)(),o=t=>{e(t),n(!1)},a=(0,Nt.useMemo)((()=>function(e){const t=ae(),n=[];for(const r in t){const i=t[r].map((t=>Lt().createElement(Mt.Menu.Item,{label:t.name,key:t.name,onClick:()=>e(t)})));n.push(Lt().createElement(Mt.Menu.Item,{label:r,key:r,childItems:i}))}return n}(o)),[e]);return Lt().createElement("div",null,!t&&Lt().createElement(Mt.Button,{icon:"plus",variant:"secondary",className:(0,qt.cx)(r.button),"aria-label":"Add new function",onClick:()=>n(!t)}),t&&Lt().createElement(Mt.ClickOutsideWrapper,{onClick:()=>{n(!1)},useCapture:!0},Lt().createElement(Mt.Input,{onChange:e=>{console.log(e.currentTarget.value)},suffix:Lt().createElement(Mt.Icon,{name:"search"})}),Lt().createElement(Mt.Menu,{style:{position:"absolute",zIndex:i.zIndex.dropdown}},a)))}function Cn(e){return{button:qt.css`
      margin-right: ${e.spacing(.5)};
    `}}function jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jn(e,t,n[t])}))}return e}function Fn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const $n=({query:e,onChange:t})=>{var n;const r=(n,r,i)=>{n.params[r]=i;const o=e.functions.findIndex((e=>e===n)),a=e.functions;a[o]=n,t(Fn(Rn({},e),{functions:a}))},i=n=>{const r=e.functions.indexOf(n),i=Q(e.functions,r,r-1);t(Fn(Rn({},e),{functions:i}))},o=n=>{const r=e.functions.indexOf(n),i=Q(e.functions,r,r+1);t(Fn(Rn({},e),{functions:i}))},a=n=>{var r;const i=null===(r=e.functions)||void 0===r?void 0:r.filter((e=>e!==n));t(Fn(Rn({},e),{functions:i}))};return Lt().createElement(Vt,null,Lt().createElement(Mt.InlineFormLabel,{width:6},"Functions"),null===(n=e.functions)||void 0===n?void 0:n.map(((e,t)=>Lt().createElement(Sn,{func:e,key:t,onParamChange:r,onMoveLeft:i,onMoveRight:o,onRemove:a}))),Lt().createElement(Dn,{onFuncAdd:n=>{const r=oe(n);r.added=!0;let i=e.functions.concat(r);i=function(e){const t=e.findIndex((e=>"Alias"===e.def.category));if(console.log(t),t>=0){const n=e[t];e.splice(t,1),e.push(n)}return e}(i),t(Fn(Rn({},e),{functions:i}))}}))};function Nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Nn(e,t,n[t])}))}return e}function kn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const _n=[{label:"all triggers",value:2},{label:"unacknowledged",value:0},{label:"acknowledged",value:1}],Mn=[{label:"Default",value:"default"},{label:"Last change",value:"lastchange"},{label:"Severity",value:"severity"}],Vn=[{label:"Default",value:"default"},{label:"True",value:"true"},{label:"False",value:"false"}],qn=({queryType:e,queryOptions:t,onChange:n})=>{const[r,i]=(0,Nt.useState)(!1),o=(0,Mt.useStyles2)(Bn),a=e=>{var r,i;const o=Number(null===(i=e)||void 0===i||null===(r=i.currentTarget)||void 0===r?void 0:r.value);null!==o&&n(kn(Ln({},t),{limit:o}))},s=e=>r=>{null!==r.value&&n(kn(Ln({},t),{[e]:r.value}))},l=()=>Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineField,{label:"Trends",labelWidth:24},Lt().createElement(Mt.Select,{isSearchable:!1,width:16,value:t.useTrends,options:Vn,onChange:s("useTrends")})),Lt().createElement(Mt.InlineField,{label:"Show disabled items",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.showDisabledItems,onChange:()=>n(kn(Ln({},t),{showDisabledItems:!t.showDisabledItems}))})),Lt().createElement(Mt.InlineField,{label:"Use Zabbix value mapping",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.useZabbixValueMapping,onChange:()=>n(kn(Ln({},t),{useZabbixValueMapping:!t.useZabbixValueMapping}))})),Lt().createElement(Mt.InlineField,{label:"Disable data alignment",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.disableDataAlignment,onChange:()=>n(kn(Ln({},t),{disableDataAlignment:!t.disableDataAlignment}))})));return Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineFieldRow,null,Lt().createElement("div",{className:o.container,onClick:()=>i(!r)},Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.HorizontalGroup,null,!r&&Lt().createElement(Mt.Icon,{name:"angle-right"}),r&&Lt().createElement(Mt.Icon,{name:"angle-down"}),Lt().createElement("span",{className:o.label},"Options"),Lt().createElement("div",{className:o.options},(()=>{const e=[];for(const n in t)if(t.hasOwnProperty(n)){const r=t[n];!0===r&&""!==r&&null!=r&&e.push(Lt().createElement("span",{className:o.optionContainer,key:n},`${n} = ${r}`))}return e})()))))),Lt().createElement(Mt.InlineFieldRow,null,r&&Lt().createElement("div",{className:o.editorContainer},e===u&&l(),e===p&&l(),e===c&&l(),e===d&&Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineField,{label:"Show disabled items",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.showDisabledItems,onChange:()=>n(kn(Ln({},t),{showDisabledItems:!t.showDisabledItems}))}))),e===h&&Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineField,{label:"Acknowledged",labelWidth:24},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:t.acknowledged,options:_n,onChange:s("acknowledged")})),Lt().createElement(Mt.InlineField,{label:"Sort by",labelWidth:24},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:t.sortProblems,options:Mn,onChange:s("sortProblems")})),Lt().createElement(Mt.InlineField,{label:"Use time range",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.useTimeRange,onChange:()=>n(kn(Ln({},t),{useTimeRange:!t.useTimeRange}))})),Lt().createElement(Mt.InlineField,{label:"Hosts in maintenance",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.hostsInMaintenance,onChange:()=>n(kn(Ln({},t),{hostsInMaintenance:!t.hostsInMaintenance}))})),Lt().createElement(Mt.InlineField,{label:"Host proxy",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.hostProxy,onChange:()=>n(kn(Ln({},t),{hostProxy:!t.hostProxy}))})),Lt().createElement(Mt.InlineField,{label:"Limit",labelWidth:24},Lt().createElement(Mt.Input,{width:12,type:"number",defaultValue:t.limit,onBlur:a}))),e===m&&Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineField,{label:"Acknowledged",labelWidth:24},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:t.acknowledged,options:_n,onChange:s("acknowledged")})),Lt().createElement(Mt.InlineField,{label:"Use time range",labelWidth:24},Lt().createElement(Mt.InlineSwitch,{value:t.useTimeRange,onChange:()=>n(kn(Ln({},t),{useTimeRange:!t.useTimeRange}))}))))))},Bn=e=>({container:(0,qt.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),marginBottom:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`,width:"100%"}),label:(0,qt.css)({color:e.colors.info.text,fontWeight:e.typography.fontWeightMedium,cursor:"pointer"}),options:(0,qt.css)({color:e.colors.text.disabled,fontSize:e.typography.bodySmall.fontSize}),optionContainer:qt.css`
    margin-right: ${e.spacing(2)};
  `,editorContainer:qt.css`
    display: flex;
    flex-direction: column;
    margin-left: ${e.spacing(4)};
  `});function Hn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function zn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Hn(o,r,i,a,s,"next",e)}function s(e){Hn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Wn(e,t,n[t])}))}return e}function Un(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Qn=({query:e,datasource:t,onChange:r})=>{var i,o,a,s;const l=(u=zn((function*(){var e;const n=null===(e=yield t.zabbix.getAllGroups())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n})),function(){return u.apply(this,arguments)});var u;const[{loading:c,value:d},p]=_t(zn((function*(){return yield l()})),[]),m=function(){var e=zn((function*(e){var r;const i=t.replaceTemplateVars(e);let o=null===(r=yield t.zabbix.getAllHosts(i))||void 0===r?void 0:r.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Ut()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:h,value:g},f]=_t(zn((function*(){return yield m(e.group.filter)})),[e.group.filter]),v=function(){var e=zn((function*(e,r){var i;const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r);let s=null===(i=yield t.zabbix.getAllApps(o,a))||void 0===i?void 0:i.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Ut()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:b,value:y},E]=_t(zn((function*(){return yield v(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),I=function(){var r=zn((function*(r,i,o,a){var s;const l=t.replaceTemplateVars(r),u=t.replaceTemplateVars(i),c=t.replaceTemplateVars(o),d=t.replaceTemplateVars(a),p={itemtype:"text",showDisabledItems:e.options.showDisabledItems};let m=null===(s=yield t.zabbix.getAllItems(l,u,c,d,p))||void 0===s?void 0:s.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Ut()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:w,value:T},O]=_t(zn((function*(){return yield I(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),x=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),P=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter),S=t.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter),A=t.replaceTemplateVars(null===(s=e.itemTag)||void 0===s?void 0:s.filter);(0,Nt.useEffect)((()=>{p()}),[]),(0,Nt.useEffect)((()=>{f()}),[x]),(0,Nt.useEffect)((()=>{E()}),[x,P]),(0,Nt.useEffect)((()=>{O()}),[x,P,S,A]);const D=t=>n=>{null!==n&&r(Un(Gn({},e),{[t]:{filter:n}}))};return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Group",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.group.filter,options:d,isLoading:c,onChange:D("group")})),Lt().createElement(Mt.InlineField,{label:"Host",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.host.filter,options:g,isLoading:h,onChange:D("host")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Application",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.application.filter,options:y,isLoading:b,onChange:D("application")})),Lt().createElement(Mt.InlineField,{label:"Item",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.item.filter,options:T,isLoading:w,onChange:D("item")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Text filter",labelWidth:12},Lt().createElement(Mt.Input,{width:24,defaultValue:e.textFilter,onBlur:t=>{var n,i;const o=null===(i=t)||void 0===i||null===(n=i.currentTarget)||void 0===n?void 0:n.value;null!==o&&r(Un(Gn({},e),{textFilter:o}))}})),Lt().createElement(Mt.InlineField,{label:"Use capture groups",labelWidth:18},Lt().createElement(Mt.InlineSwitch,{value:e.useCaptureGroups,onChange:()=>r(Un(Gn({},e),{useCaptureGroups:!e.useCaptureGroups}))}))))};function Xn(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Zn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Xn(o,r,i,a,s,"next",e)}function s(e){Xn(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Yn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Yn(e,t,n[t])}))}return e}function Kn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const er=[{label:"Problems",value:"problems"},{label:"Recent problems",value:"recent"},{label:"History",value:"history"}],tr=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],nr=[{label:"AND/OR",value:P.AndOr},{label:"OR",value:P.Or}],rr=({query:e,datasource:t,onChange:r})=>{var i,o,a,s,l,u,c,d,p;const m=(h=Zn((function*(){var e;const n=null===(e=yield t.zabbix.getAllGroups())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n})),function(){return h.apply(this,arguments)});var h;const[{loading:g,value:f},v]=_t(Zn((function*(){return yield m()})),[]),b=function(){var e=Zn((function*(e){var r;const i=t.replaceTemplateVars(e);let o=null===(r=yield t.zabbix.getAllHosts(i))||void 0===r?void 0:r.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Ut()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:y,value:E},I]=_t(Zn((function*(){return yield b(e.group.filter)})),[e.group.filter]),w=function(){var e=Zn((function*(e,r){var i;const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r);let s=null===(i=yield t.zabbix.getAllApps(o,a))||void 0===i?void 0:i.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Ut()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:T,value:O},x]=_t(Zn((function*(){return yield w(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),P=function(){var e=Zn((function*(){var e;const n=null===(e=yield t.zabbix.getProxies())||void 0===e?void 0:e.map((e=>({value:e.host,label:e.host})));return n.unshift(...Ut()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:S,value:A},D]=_t(Zn((function*(){return yield P()})),[]),C=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),j=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter);(0,Nt.useEffect)((()=>{v()}),[]),(0,Nt.useEffect)((()=>{I()}),[C]),(0,Nt.useEffect)((()=>{x()}),[C,j]),(0,Nt.useEffect)((()=>{D()}),[]);const R=t=>n=>{var i,o;const a=null===(o=n)||void 0===o||null===(i=o.currentTarget)||void 0===i?void 0:i.value;null!==a&&r(Kn(Jn({},e),{[t]:{filter:a}}))},F=t=>n=>{null!==n&&r(Kn(Jn({},e),{[t]:{filter:n}}))},$=t=>n=>{null!==n.value&&r(Kn(Jn({},e),{[t]:n.value}))},N=t.zabbix.supportsApplications();return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Group",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(a=e.group)||void 0===a?void 0:a.filter,options:f,isLoading:g,onChange:F("group")})),Lt().createElement(Mt.InlineField,{label:"Host",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(s=e.host)||void 0===s?void 0:s.filter,options:E,isLoading:y,onChange:F("host")})),Lt().createElement(Mt.InlineField,{label:"Proxy",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(l=e.proxy)||void 0===l?void 0:l.filter,options:A,isLoading:S,onChange:F("proxy")}))),Lt().createElement(Vt,null,N&&Lt().createElement(Mt.InlineField,{label:"Application",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(u=e.application)||void 0===u?void 0:u.filter,options:O,isLoading:T,onChange:F("application")})),Lt().createElement(Mt.InlineField,{label:"Problem",labelWidth:12},Lt().createElement(Mt.Input,{width:24,defaultValue:null===(c=e.trigger)||void 0===c?void 0:c.filter,placeholder:"Problem name",onBlur:R("trigger")})),Lt().createElement(Mt.InlineField,{label:"Tags",labelWidth:12},Lt().createElement(Mt.Input,{width:36,defaultValue:null===(d=e.tags)||void 0===d?void 0:d.filter,placeholder:"tag1:value1, tag2:value2",onBlur:R("tags")})),Lt().createElement(Mt.InlineField,null,Lt().createElement(Mt.Select,{isSearchable:!1,width:15,value:e.evaltype,options:nr,onChange:$("evaltype")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Show",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:e.showProblems,options:er,onChange:$("showProblems")})),Lt().createElement(Mt.InlineField,{label:"Severity",labelWidth:12},Lt().createElement(Mt.MultiSelect,{isSearchable:!1,isClearable:!0,placeholder:"Show all problems",value:null===(p=e.options)||void 0===p?void 0:p.severities,options:tr,onChange:t=>{null!==t&&r(Kn(Jn({},e),{options:Kn(Jn({},e.options),{severities:t.map((e=>e.value))})}))}}))))};function ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const or=({query:e,onChange:t})=>Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Item Ids",labelWidth:12},Lt().createElement(Mt.Input,{width:24,defaultValue:e.itemids,onBlur:n=>{var r,i;const o=null===(i=n)||void 0===i||null===(r=i.currentTarget)||void 0===r?void 0:r.value;var a,s;null!==o&&t((a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ir(e,t,n[t])}))}return e}({},e),s=null!=(s={itemids:o})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(s)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(s)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(s,e))})),a))}})));function ar(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function sr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ar(o,r,i,a,s,"next",e)}function s(e){ar(o,r,i,a,s,"throw",e)}a(void 0)}))}}function lr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){lr(e,t,n[t])}))}return e}function cr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const dr=[{label:"Status",value:"status"},{label:"SLI",value:"sli"},{label:"Uptime",value:"uptime"},{label:"Downtime",value:"downtime"},{label:"Error budget",value:"error_budget"}],pr=[{label:"No interval",value:"none"},{label:"Auto",value:"auto"},{label:"1 hour",value:"1h"},{label:"12 hours",value:"12h"},{label:"24 hours",value:"1d"},{label:"1 week",value:"1w"},{label:"1 month",value:"1M"}],mr=({query:e,datasource:t,onChange:n})=>{const r=(i=sr((function*(){var e;const n=null===(e=yield t.zabbix.getITService())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n})),function(){return i.apply(this,arguments)});var i;const[{loading:o,value:a},s]=_t(sr((function*(){return yield r()})),[]),l=function(){var e=sr((function*(){var e;const n=null===(e=yield t.zabbix.getSLAList())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:u,value:c},d]=_t(sr((function*(){return yield l()})),[]);(0,Nt.useEffect)((()=>{s(),d()}),[]);const p=t=>r=>{r.value&&n(cr(ur({},e),{[t]:r.value}))},m=t=>r=>{void 0!==r&&n(cr(ur({},e),{[t]:r}))};return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Service",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.itServiceFilter,options:a,isLoading:o,onChange:m("itServiceFilter")})),Lt().createElement(Mt.InlineField,{label:"SLA",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.slaFilter,options:c,isLoading:u,onChange:m("slaFilter")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Property",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:e.slaProperty,options:dr,onChange:p("slaProperty")})),Lt().createElement(Mt.InlineField,{label:"Interval",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:e.slaInterval,options:pr,onChange:p("slaInterval")}))))};function hr(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function gr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){hr(o,r,i,a,s,"next",e)}function s(e){hr(o,r,i,a,s,"throw",e)}a(void 0)}))}}function fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fr(e,t,n[t])}))}return e}function br(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const yr=[{value:"",label:"All triggers"},{value:"problems",label:"Problems"},{value:"items",label:"Items"}],Er=[{value:0,label:"Not classified"},{value:1,label:"Information"},{value:2,label:"Warning"},{value:3,label:"Average"},{value:4,label:"High"},{value:5,label:"Disaster"}],Ir=({query:e,datasource:t,onChange:r})=>{var i,o,a,s,l,u,c,d,p,m,h,g;const f=(v=gr((function*(){var e;const n=null===(e=yield t.zabbix.getAllGroups())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n})),function(){return v.apply(this,arguments)});var v;const[{loading:b,value:y},E]=_t(gr((function*(){return yield f()})),[]),I=function(){var e=gr((function*(e){var r;const i=t.replaceTemplateVars(e);let o=null===(r=yield t.zabbix.getAllHosts(i))||void 0===r?void 0:r.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Ut()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:w,value:T},O]=_t(gr((function*(){return yield I(e.group.filter)})),[e.group.filter]),x=function(){var e=gr((function*(e,r){var i;const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r);let s=null===(i=yield t.zabbix.getAllApps(o,a))||void 0===i?void 0:i.map((e=>({value:e.name,label:e.name})));return s=n().uniqBy(s,(e=>e.value)),s.unshift(...Ut()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:P,value:S},A]=_t(gr((function*(){return yield x(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),D=function(){var e=gr((function*(e,r){var i;if(!(yield t.zabbix.isZabbix54OrHigher()))return[];const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r),s=yield t.zabbix.getAllItems(o,a,null,null,{}),l=n().flatten(s.map((e=>e.tags||[])));let u=null===(i=n().uniqBy(l,(e=>e.tag+e.value||"")).map((e=>H(e))))||void 0===i?void 0:i.map((e=>({value:e,label:e})));return u=n().uniqBy(u,(e=>e.value)),u.unshift(...Ut()),u}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:C,value:j},R]=_t(gr((function*(){return yield D(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),F=function(){var e=gr((function*(){var e;const n=null===(e=yield t.zabbix.getProxies())||void 0===e?void 0:e.map((e=>({value:e.host,label:e.host})));return n.unshift(...Ut()),n}));return function(){return e.apply(this,arguments)}}(),[{loading:$,value:N},L]=_t(gr((function*(){return yield F()})),[]),k=function(){var r=gr((function*(r,i,o,a){var s;const l=t.replaceTemplateVars(r),u=t.replaceTemplateVars(i),c=t.replaceTemplateVars(o),d=t.replaceTemplateVars(a),p={itemtype:"num",showDisabledItems:e.options.showDisabledItems};let m=null===(s=yield t.zabbix.getAllItems(l,u,c,d,p))||void 0===s?void 0:s.map((e=>({value:e.name,label:e.name})));return m=n().uniqBy(m,(e=>e.value)),m.unshift(...Ut()),m}));return function(e,t,n,i){return r.apply(this,arguments)}}(),[{loading:_,value:M},V]=_t(gr((function*(){return yield k(e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter)})),[e.group.filter,e.host.filter,e.application.filter,e.itemTag.filter]),q=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),B=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter),z=t.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter),W=t.replaceTemplateVars(null===(s=e.itemTag)||void 0===s?void 0:s.filter);(0,Nt.useEffect)((()=>{E()}),[]),(0,Nt.useEffect)((()=>{O()}),[q]),(0,Nt.useEffect)((()=>{A()}),[q,B]),(0,Nt.useEffect)((()=>{R()}),[q,B]),(0,Nt.useEffect)((()=>{L()}),[]),(0,Nt.useEffect)((()=>{V()}),[q,B,z,W]);const G=t=>n=>{var i,o;const a=null===(o=n)||void 0===o||null===(i=o.currentTarget)||void 0===i?void 0:i.value;null!==a&&r(br(vr({},e),{[t]:{filter:a}}))},U=t=>n=>{null!==n&&r(br(vr({},e),{[t]:{filter:n}}))},Q=t.zabbix.supportsApplications();return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Count by",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:e.countTriggersBy,options:yr,onChange:t=>{null!==t.value&&r(br(vr({},e),{countTriggersBy:t.value}))}}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Group",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(l=e.group)||void 0===l?void 0:l.filter,options:y,isLoading:b,onChange:U("group")})),Lt().createElement(Mt.InlineField,{label:"Host",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(u=e.host)||void 0===u?void 0:u.filter,options:T,isLoading:w,onChange:U("host")})),"problems"===e.countTriggersBy&&Lt().createElement(Mt.InlineField,{label:"Proxy",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(c=e.proxy)||void 0===c?void 0:c.filter,options:N,isLoading:$,onChange:U("proxy")}))),Lt().createElement(Vt,null,Q&&Lt().createElement(Mt.InlineField,{label:"Application",labelWidth:12},Lt().createElement(Wt,{width:24,value:null===(d=e.application)||void 0===d?void 0:d.filter,options:S,isLoading:P,onChange:U("application")})),!Q&&"items"===e.countTriggersBy&&Lt().createElement(Mt.InlineField,{label:"Item tag",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.itemTag.filter,options:j,isLoading:C,onChange:U("itemTag")})),"problems"===e.countTriggersBy&&Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineField,{label:"Problem",labelWidth:12},Lt().createElement(Mt.Input,{width:24,defaultValue:null===(p=e.trigger)||void 0===p?void 0:p.filter,placeholder:"Problem name",onBlur:G("trigger")}))),"items"===e.countTriggersBy&&Lt().createElement(Mt.InlineField,{label:"Item",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.item.filter,options:M,isLoading:_,onChange:U("item")})),!Q&&Lt().createElement(Mt.InlineField,{label:"Tags",labelWidth:12},Lt().createElement(Mt.Input,{width:24,defaultValue:null===(m=e.tags)||void 0===m?void 0:m.filter,placeholder:"tag1:value1, tag2:value2",onBlur:G("tags")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Min severity",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:null===(h=e.options)||void 0===h?void 0:h.minSeverity,options:Er,onChange:t=>{null!==t.value&&r(br(vr({},e),{options:br(vr({},e.options),{minSeverity:t.value})}))}})),Lt().createElement(Mt.InlineField,{label:"Count",labelWidth:12},Lt().createElement(Mt.InlineSwitch,{value:null===(g=e.options)||void 0===g?void 0:g.count,onChange:()=>{var t;return r(br(vr({},e),{options:br(vr({},e.options),{count:!(null===(t=e.options)||void 0===t?void 0:t.count)})}))}}))))};function wr(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Tr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){wr(o,r,i,a,s,"next",e)}function s(e){wr(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Or(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const xr=({query:e,datasource:t,onChange:r})=>{var i,o;const a=(s=Tr((function*(){var e;const n=null===(e=yield t.zabbix.getAllGroups())||void 0===e?void 0:e.map((e=>({value:e.name,label:e.name})));return n.unshift(...Ut()),n})),function(){return s.apply(this,arguments)});var s;const[{loading:l,value:u},c]=_t(Tr((function*(){return yield a()})),[]),d=function(){var e=Tr((function*(e){var r;const i=t.replaceTemplateVars(e);let o=null===(r=yield t.zabbix.getAllHosts(i))||void 0===r?void 0:r.map((e=>({value:e.name,label:e.name})));return o=n().uniqBy(o,(e=>e.value)),o.unshift({value:"/.*/"}),o.unshift(...Ut()),o}));return function(t){return e.apply(this,arguments)}}(),[{loading:p,value:m},h]=_t(Tr((function*(){return yield d(e.group.filter)})),[e.group.filter]),g=function(){var e=Tr((function*(e,r){var i;const o=t.replaceTemplateVars(e),a=t.replaceTemplateVars(r);let s=null===(i=yield t.zabbix.getAllMacros(o,a))||void 0===i?void 0:i.map((e=>({value:e.macro,label:e.macro})));return s=n().uniqBy(s,(e=>e.value)),s.unshift({value:"/.*/"}),s.unshift(...Ut()),s}));return function(t,n){return e.apply(this,arguments)}}(),[{loading:f,value:v},b]=_t(Tr((function*(){return yield g(e.group.filter,e.host.filter)})),[e.group.filter,e.host.filter]),y=t.replaceTemplateVars(null===(i=e.group)||void 0===i?void 0:i.filter),E=t.replaceTemplateVars(null===(o=e.host)||void 0===o?void 0:o.filter);(0,Nt.useEffect)((()=>{c()}),[]),(0,Nt.useEffect)((()=>{h()}),[y]),(0,Nt.useEffect)((()=>{b()}),[y,E]);const I=t=>n=>{var i,o;null!==n&&r((i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Or(e,t,n[t])}))}return e}({},e),o=null!=(o={[t]:{filter:n}})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(o)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})),i))};return Lt().createElement(Lt().Fragment,null,Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Group",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.group.filter,options:u,isLoading:l,onChange:I("group")})),Lt().createElement(Mt.InlineField,{label:"Host",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.host.filter,options:m,isLoading:p,onChange:I("host")}))),Lt().createElement(Vt,null,Lt().createElement(Mt.InlineField,{label:"Macros",labelWidth:12},Lt().createElement(Wt,{width:24,value:e.macro.filter,options:v,isLoading:f,onChange:I("macro")}))))};function Pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pr(e,t,n[t])}))}return e}function Ar(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Dr=[{value:u,label:"Metrics",description:"Query numeric metrics"},{value:d,label:"Text",description:"Query text data"},{value:c,label:"Services",description:"Query services SLA"},{value:p,label:"Item Id",description:"Query metrics by item ids"},{value:m,label:"Triggers",description:"Count triggers"},{value:h,label:"Problems",description:"Query problems"},{value:v,label:"User macros",description:"User Macros"}];function Cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jr;const Rr=(null===(jr=Mt.LegacyForms)||void 0===jr?void 0:jr.Input)||Mt.Input,Fr=RegExp(`^${/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g.source}`),$r=e=>({inputRegex:qt.css`
    color: ${e.colors.warning.main};
  `,inputVariable:qt.css`
    color: ${e.colors.action.focus};
  `}),Nr={[Mt.EventsWithValidation.onBlur]:[{rule:e=>!e||!(e.length>1&&"/"===e[0]&&"/"!==e[e.length-1]),errorMessage:"Not a valid regex"},{rule:e=>"*"!==e,errorMessage:"Wildcards not supported. Use /.*/ instead"}]},Lr=e=>{var{value:t,ref:n,validationEvents:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["value","ref","validationEvents"]);const o=(0,Mt.useStyles2)($r);let a=o.inputRegex;return Fr.test(t)?a=o.inputVariable:F(t)&&(a=o.inputRegex),Lt().createElement(Rr,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Cr(e,t,n[t])}))}return e}({className:a,value:t,validationEvents:Nr},i))};function kr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){kr(e,t,n[t])}))}return e}function Mr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class Vr extends Nt.PureComponent{getSelectedQueryType(e){return this.queryTypes.find((t=>t.value===e))}render(){var e,t;const{selectedQueryType:n,legacyQuery:r,group:i,host:o,application:a,itemTag:s,item:l}=this.state,{datasource:u}=this.props,c=(null===(t=u)||void 0===t||null===(e=t.zabbix)||void 0===e?void 0:e.isZabbix54OrHigherSync())||!1;return Lt().createElement(Lt().Fragment,null,Lt().createElement("div",{className:"gf-form max-width-21"},Lt().createElement(Mt.InlineFormLabel,{width:10},"Query Type"),Lt().createElement(Mt.Select,{width:11,value:n,options:this.queryTypes,onChange:this.handleQueryTypeChange})),Lt().createElement("div",{className:"gf-form-inline"},Lt().createElement("div",{className:"gf-form max-width-30"},Lt().createElement(Mt.InlineFormLabel,{width:10},"Group"),Lt().createElement(Lr,{value:i,onChange:e=>this.handleQueryUpdate(e,"group"),onBlur:this.handleQueryChange})),n.value!==E.Group&&Lt().createElement("div",{className:"gf-form max-width-30"},Lt().createElement(Mt.InlineFormLabel,{width:10},"Host"),Lt().createElement(Lr,{value:o,onChange:e=>this.handleQueryUpdate(e,"host"),onBlur:this.handleQueryChange}))),(n.value===E.Application||n.value===E.ItemTag||n.value===E.Item||n.value===E.ItemValues)&&Lt().createElement("div",{className:"gf-form-inline"},c&&Lt().createElement("div",{className:"gf-form max-width-30"},Lt().createElement(Mt.InlineFormLabel,{width:10},"Item tag"),Lt().createElement(Lr,{value:s,onChange:e=>this.handleQueryUpdate(e,"itemTag"),onBlur:this.handleQueryChange})),!c&&Lt().createElement("div",{className:"gf-form max-width-30"},Lt().createElement(Mt.InlineFormLabel,{width:10},"Application"),Lt().createElement(Lr,{value:a,onChange:e=>this.handleQueryUpdate(e,"application"),onBlur:this.handleQueryChange})),(n.value===E.Item||n.value===E.ItemValues)&&Lt().createElement("div",{className:"gf-form max-width-30"},Lt().createElement(Mt.InlineFormLabel,{width:10},"Item"),Lt().createElement(Lr,{value:l,onChange:e=>this.handleQueryUpdate(e,"item"),onBlur:this.handleQueryChange}))),r&&Lt().createElement("div",{className:"gf-form"},Lt().createElement(Mt.InlineFormLabel,{width:10,tooltip:"Original query string, read-only"},"Legacy Query"),Lt().createElement(Mt.Input,{value:r,readOnly:!0})))}constructor(e){if(super(e),kr(this,"queryTypes",[{value:E.Group,label:"Group"},{value:E.Host,label:"Host"},{value:E.Application,label:"Application"},{value:E.ItemTag,label:"Item tag"},{value:E.Item,label:"Item"},{value:E.ItemValues,label:"Item values"}]),kr(this,"defaults",{selectedQueryType:{value:E.Group,label:"Group"},queryType:E.Group,group:"/.*/",host:"",application:"",itemTag:"",item:""}),kr(this,"handleQueryUpdate",((e,t)=>{const n=e.currentTarget.value;this.setState((e=>{const r=_r({},e);return r[t]=n,_r({},r)}))})),kr(this,"handleQueryChange",(()=>{const{queryType:e,group:t,host:n,application:r,itemTag:i,item:o}=this.state,a={queryType:e,group:t,host:n,application:r,itemTag:i,item:o};this.props.onChange(a,`Zabbix - ${e}`)})),kr(this,"handleQueryTypeChange",(e=>{this.setState(Mr(_r({},this.state),{selectedQueryType:e,queryType:e.value}));const{group:t,host:n,application:r,itemTag:i,item:o}=this.state,a=e.value,s={queryType:a,group:t,host:n,application:r,itemTag:i,item:o};this.props.onChange(s,`Zabbix - ${a}`)})),this.props.query&&"string"==typeof this.props.query){const e=j(this.props.query),t=this.getSelectedQueryType(e.queryType);this.state=_r({selectedQueryType:t,legacyQuery:this.props.query},e)}else if(this.props.query){const e=this.props.query,t=this.getSelectedQueryType(e.queryType);this.state=Mr(_r({},this.defaults,e),{selectedQueryType:t})}else this.state=this.defaults}}function qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Br(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qr(e,t,n[t])}))}return e}function Hr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{FormField:zr,Switch:Wr}=Mt.LegacyForms,Gr=["mysql","postgres","influxdb"],Ur=[{label:"User and password",value:x.UserLogin},{label:"API token",value:x.Token}],Qr=(e,t,n)=>r=>{n(Hr(Br({},t),{jsonData:Hr(Br({},t.jsonData),{[e]:r.currentTarget.value})}))},Xr=(e,t,n)=>r=>{n(Hr(Br({},t),{jsonData:Hr(Br({},t.jsonData),{[e]:r.value})}))},Zr=(e,t,n)=>r=>{n(Hr(Br({},t),{jsonData:Hr(Br({},t.jsonData),{[e]:r.target.checked})}))},Yr=(e,t,n)=>r=>{n(Hr(Br({},t),{secureJsonData:Hr(Br({},t.secureJsonData),{[e]:r.currentTarget.value})}))},Jr=(e,t,n)=>r=>{n(Hr(Br({},t),{secureJsonFields:Hr(Br({},t.secureJsonFields),{[e]:!1})}))},Kr=(e,t,n,r)=>i=>{const o=ei().find((e=>e.id===i.value));n({label:o.name,value:o.id}),r(o.type),t(Hr(Br({},e),{jsonData:Hr(Br({},e.jsonData),{dbConnectionDatasourceId:i.value})}))},ei=()=>{let e=(0,se.getDataSourceSrv)().getAll();return e=e.filter((e=>Gr.includes(e.type))),e},ti=new e.DataSourcePlugin(sn).setConfigEditor((e=>{var t,n,r,i,o;const{options:a,onOptionsChange:s}=e,[l,u]=(0,Nt.useState)(null),[c,d]=(0,Nt.useState)("");return(0,Nt.useEffect)((()=>{var e;const{jsonData:t,secureJsonFields:n}=a,{password:r}=t,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(t,["password"]);if((null===(e=n)||void 0===e?void 0:e.password)||(a.secureJsonData||(a.secureJsonData={}),a.secureJsonData.password=r),s(Hr(Br({},a),{jsonData:Br({authType:x.UserLogin,trends:!0,trendsFrom:"",trendsRange:"",cacheTTL:"",timeout:void 0,disableDataAlignment:!1},i)})),a.jsonData.dbConnectionEnable)if(a.jsonData.dbConnectionDatasourceId){var o,l,c;const e=ei().find((e=>e.id===a.jsonData.dbConnectionDatasourceId));u({label:null===(o=e)||void 0===o?void 0:o.name,value:null===(l=e)||void 0===l?void 0:l.id}),d(null===(c=e)||void 0===c?void 0:c.type)}else{const e=a.jsonData.dbConnectionDatasourceName;(0,se.getDataSourceSrv)().get(e).then((e=>{if(e){var t,n,r;const i=ei().find((t=>t.id===e.id));u({label:null===(t=i)||void 0===t?void 0:t.name,value:null===(n=i)||void 0===n?void 0:n.id}),d(null===(r=i)||void 0===r?void 0:r.type),s(Hr(Br({},a),{jsonData:Hr(Br({},a.jsonData),{dbConnectionDatasourceId:e.id})}))}}))}}),[]),Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.DataSourceHttpSettings,{defaultUrl:"http://localhost/zabbix/api_jsonrpc.php",dataSourceConfig:a,showAccessOptions:!0,onChange:s}),Lt().createElement("div",{className:"gf-form-group"},Lt().createElement("h3",{className:"page-heading"},"Zabbix API details"),Lt().createElement("div",{className:"gf-form"},Lt().createElement(Mt.InlineFormLabel,{width:7,tooltip:"Token authentication available in Zabbix version 5.4 and higher."},"Auth type"),Lt().createElement(Mt.Select,{width:30,options:Ur,value:a.jsonData.authType,onChange:Xr("authType",a,s)})),(null===(t=a.jsonData)||void 0===t?void 0:t.authType)===x.Token?Lt().createElement(Lt().Fragment,null,Lt().createElement("div",{className:"gf-form max-width-25"},(null===(n=a.secureJsonFields)||void 0===n?void 0:n.apiToken)?Lt().createElement(Lt().Fragment,null,Lt().createElement(zr,{labelWidth:7,inputWidth:15,label:"API token",disabled:!0,value:"",placeholder:"Configured"}),Lt().createElement(Mt.Button,{onClick:Jr("apiToken",a,s)},"Reset")):Lt().createElement(zr,{labelWidth:7,inputWidth:15,label:"API token",type:"password",value:(null===(r=a.secureJsonData)||void 0===r?void 0:r.apiToken)||"",onChange:Yr("apiToken",a,s),required:!0}))):Lt().createElement(Lt().Fragment,null,Lt().createElement("div",{className:"gf-form max-width-25"},Lt().createElement(zr,{labelWidth:7,inputWidth:15,label:"Username",value:a.jsonData.username||"",onChange:Qr("username",a,s),required:!0})),Lt().createElement("div",{className:"gf-form max-width-25"},(null===(i=a.secureJsonFields)||void 0===i?void 0:i.password)?Lt().createElement(Lt().Fragment,null,Lt().createElement(zr,{labelWidth:7,inputWidth:15,label:"Password",disabled:!0,value:"",placeholder:"Configured"}),Lt().createElement(Mt.Button,{onClick:Jr("password",a,s)},"Reset")):Lt().createElement(zr,{labelWidth:7,inputWidth:15,label:"Password",type:"password",value:(null===(o=a.secureJsonData)||void 0===o?void 0:o.password)||a.jsonData.password||"",onChange:Yr("password",a,s),required:!0}))),Lt().createElement(Wr,{label:"Trends",labelClass:"width-7",checked:a.jsonData.trends,onChange:Zr("trends",a,s)}),a.jsonData.trends&&Lt().createElement(Lt().Fragment,null,Lt().createElement("div",{className:"gf-form"},Lt().createElement(zr,{labelWidth:7,inputWidth:4,label:"After",value:a.jsonData.trendsFrom||"",placeholder:"7d",onChange:Qr("trendsFrom",a,s),tooltip:"Time after which trends will be used. Best practice is to set this value to your history storage period (7d, 30d, etc)."})),Lt().createElement("div",{className:"gf-form"},Lt().createElement(zr,{labelWidth:7,inputWidth:4,label:"Range",value:a.jsonData.trendsRange||"",placeholder:"4d",onChange:Qr("trendsRange",a,s),tooltip:"Time range width after which trends will be used instead of history. It's better to set this value in range of 4 to 7 days to prevent loading large amount of history data."}))),Lt().createElement("div",{className:"gf-form"},Lt().createElement(zr,{labelWidth:7,inputWidth:4,label:"Cache TTL",value:a.jsonData.cacheTTL||"",placeholder:"1h",onChange:Qr("cacheTTL",a,s),tooltip:"Zabbix data source caches metric names in memory. Specify how often data will be updated."})),Lt().createElement("div",{className:"gf-form"},Lt().createElement(zr,{labelWidth:7,inputWidth:4,type:"number",label:"Timeout",value:a.jsonData.timeout,onChange:e=>{s(Hr(Br({},a),{jsonData:Hr(Br({},a.jsonData),{timeout:parseInt(e.currentTarget.value,10)})}))},tooltip:"Zabbix API connection timeout in seconds. Default is 30."}))),Lt().createElement("div",{className:"gf-form-group"},Lt().createElement("h3",{className:"page-heading"},"Direct DB Connection"),Lt().createElement(Wr,{label:"Enable",labelClass:"width-9",checked:a.jsonData.dbConnectionEnable,onChange:Zr("dbConnectionEnable",a,s)}),a.jsonData.dbConnectionEnable&&Lt().createElement(Lt().Fragment,null,Lt().createElement("div",{className:"gf-form"},Lt().createElement(Mt.InlineFormLabel,{width:9},"Data Source"),Lt().createElement(Mt.Select,{width:32,options:ei().map((e=>({label:e.name,value:e.id,description:e.type}))),value:l,onChange:Kr(a,s,u,d)})),"influxdb"===c&&Lt().createElement("div",{className:"gf-form"},Lt().createElement(zr,{labelWidth:9,inputWidth:16,label:"Retention Policy",value:a.jsonData.dbConnectionRetentionPolicy||"",placeholder:"Retention policy name",onChange:Qr("dbConnectionRetentionPolicy",a,s),tooltip:"Specify retention policy name for fetching long-term stored data (optional). Leave it blank if only default retention policy used."})))),Lt().createElement("div",{className:"gf-form-group"},Lt().createElement("h3",{className:"page-heading"},"Other"),Lt().createElement(Wr,{label:"Disable acknowledges for read-only users",labelClass:"width-20",checked:a.jsonData.disableReadOnlyUsersAck,onChange:Zr("disableReadOnlyUsersAck",a,s)}),Lt().createElement(Wr,{label:"Disable data alignment",labelClass:"width-20",checked:!!a.jsonData.disableDataAlignment,onChange:Zr("disableDataAlignment",a,s),tooltip:"Data alignment feature aligns points based on item update interval. For instance, if value collected once per minute, then timestamp of the each point will be set to the start of corresponding minute. This alignment required for proper work of the stacked graphs. If you don't need stacked graphs and want to get exactly the same timestamps as in Zabbix, then you can disable this feature."})),se.config.featureToggles.secureSocksDSProxyEnabled&&(0,ze.gte)(se.config.buildInfo.version,"10.0.0-0")&&Lt().createElement("div",{className:"gf-form-group"},Lt().createElement(Wr,{label:"Secure Socks Proxy",labelClass:"width-20",checked:a.jsonData.enableSecureSocksProxy,tooltip:"Enable proxying the datasource connection through the secure socks proxy to a different network.",onChange:Zr("enableSecureSocksProxy",a,s)})))})).setQueryEditor((({query:e,datasource:t,onChange:n,onRunQuery:r})=>{const i={schema:12,queryType:u,group:{filter:""},host:{filter:""},application:{filter:""},itemTag:{filter:""},item:{filter:""},macro:{filter:""},functions:[],trigger:{filter:""},countTriggersBy:"",tags:{filter:""},proxy:{filter:""},textFilter:"",evaltype:P.AndOr,options:{showDisabledItems:!1,skipEmptyValues:!1,disableDataAlignment:!1,useZabbixValueMapping:!1,useTrends:"default",count:!1},table:{skipEmptyValues:!1}};(e=Sr({},i,e)).options=Sr({},i.options,e.options);const{queryType:o}=e;if(o===h||o===m){const t={showProblems:I.Problems,options:{minSeverity:0,sortProblems:"default",acknowledged:2,hostsInMaintenance:!1,hostProxy:!1,limit:1001,useTimeRange:!1,count:!1}};(e=Sr({},t,e)).options=Sr({},t.options,e.options)}o===c&&(e=Sr({},{itServiceFilter:"",slaFilter:"",slaProperty:"sla",slaInterval:"none"},e)),(0,Nt.useEffect)((()=>{const t=Y(e);n(t)}),[]);const a=e=>{n(e),r()};return Lt().createElement(Lt().Fragment,null,Lt().createElement(Mt.InlineFieldRow,null,Lt().createElement(Mt.InlineField,{label:"Query type",labelWidth:12},Lt().createElement(Mt.Select,{isSearchable:!1,width:24,value:o,options:Dr,onChange:("queryType",t=>{null!==t.value&&a(Ar(Sr({},e),{queryType:t.value}))})})),Lt().createElement("div",{className:"gf-form gf-form--grow"},Lt().createElement("div",{className:"gf-form-label gf-form-label--grow"}))),o===u&&Lt().createElement(Lt().Fragment,null,Lt().createElement(bn,{query:e,datasource:t,onChange:a}),Lt().createElement($n,{query:e,onChange:a})),o===p&&Lt().createElement(Lt().Fragment,null,Lt().createElement(or,{query:e,onChange:a}),Lt().createElement($n,{query:e,onChange:a})),o===d&&Lt().createElement(Lt().Fragment,null,Lt().createElement(Qn,{query:e,datasource:t,onChange:a})),o===c&&Lt().createElement(Lt().Fragment,null,Lt().createElement(mr,{query:e,datasource:t,onChange:a}),Lt().createElement($n,{query:e,onChange:a})),o===h&&Lt().createElement(rr,{query:e,datasource:t,onChange:a}),o===m&&Lt().createElement(Ir,{query:e,datasource:t,onChange:a}),o===v&&Lt().createElement(xr,{query:e,datasource:t,onChange:a}),Lt().createElement(qn,{queryType:o,queryOptions:e.options,onChange:t=>{a(Ar(Sr({},e),{options:t}))}}))})).setVariableQueryEditor(Vr)})(),f})()));
//# sourceMappingURL=module.js.map